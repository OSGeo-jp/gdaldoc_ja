<!DOCTYPE html>
<html class="writer-html5" lang="ja" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Python Gotchas in the GDAL and OGR Python Bindings &mdash; GDAL  ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../_static/css/gdal.css?v=e152ac3b" />

  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="canonical" href="https://gdal.org/api/python_gotchas.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=c033477b"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=4dbe4bdc"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="Python Sample scripts" href="python_samples.html" />
    <link rel="prev" title="osgeo.osr module" href="python/osgeo.osr.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../index.html">
            
              <img src="../_static/gdalicon.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../download.html">ダウンロード</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/index.html">Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers/raster/index.html">Raster drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers/vector/index.html">Vector drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">ユーザー</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sponsors/index.html">Sponsors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">How to contribute?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">ライセンス</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GDAL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html"> GDAL  ドキュメント </a> &raquo;</li>
      
          <li><a href="index.html">API</a> &raquo;</li>
      
      <li>Python Gotchas in the GDAL and OGR Python Bindings</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSGeo/gdal/edit/master/doc/source/api/python_gotchas.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="python_samples.html" class="btn btn-neutral float-right" title="Python Sample scripts" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="python/osgeo.osr.html" class="btn btn-neutral float-left" title="osgeo.osr module" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="python-gotchas-in-the-gdal-and-ogr-python-bindings">
<span id="python-gotchas"></span><h1>Python Gotchas in the GDAL and OGR Python Bindings<a class="headerlink" href="#python-gotchas-in-the-gdal-and-ogr-python-bindings" title="Link to this heading"></a></h1>
<p>This page lists aspects of GDAL's and OGR's Python bindings that may catch Python programmers by surprise.
If you find something new, feel free to open a pull request adding it to the list. Consider discussing it on the <a class="reference external" href="https://lists.osgeo.org/mailman/listinfo/gdal-dev">gdal-dev mailing list</a>  first,
to make sure you fully understand the issue and that others agree that it is unexpected, &quot;non-Pythonic&quot;,
or something that would catch many Python programmers by surprise.
Be sure to reference email threads, GitHub tickets, and other sources of additional information.</p>
<p>This list is not the place to report bugs. If you believe something is a bug, please <a class="reference external" href="https://github.com/OSGeo/gdal/issues">open a ticket</a> and report the problem to gdal-dev.
Then consider listing it here if it is something related to Python specifically. Do not list it here if it relates to GDAL or OGR generally, and not the Python bindings specifically.</p>
<p>Not all items listed here are bugs. Some of these are just how GDAL and OGR work and cannot be fixed easily without breaking existing code.
If you don't like how something works and think it should be changed, feel free to discuss it on gdal-dev and see what can be done.</p>
<section id="gotchas-that-are-by-design-or-per-history">
<h2>Gotchas that are by design... or per history<a class="headerlink" href="#gotchas-that-are-by-design-or-per-history" title="Link to this heading"></a></h2>
<p>These are unexpected behaviors that are not considered by the GDAL and OGR teams to be bugs and are unlikely to be changed due to effort required, or whose fixing might affect backward compatibility, etc.</p>
<section id="python-bindings-do-not-raise-exceptions-unless-you-explicitly-call-useexceptions">
<h3>Python bindings do not raise exceptions unless you explicitly call <code class="docutils literal notranslate"><span class="pre">UseExceptions()</span></code><a class="headerlink" href="#python-bindings-do-not-raise-exceptions-unless-you-explicitly-call-useexceptions" title="Link to this heading"></a></h3>
<p>By default, the GDAL and OGR Python bindings do not raise exceptions when errors occur.
Instead they return an error value such as <code class="docutils literal notranslate"><span class="pre">None</span></code> and write an error message to <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code>. For example, when you try to open a non-existing dataset with GDAL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">foo.img&#39;</span><span class="p">)</span>
<span class="go">ERROR 4: &#39;C:\foo.img does not exist in the file system,</span>
<span class="go">and is not recognized as a supported dataset name.</span>

<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>In Python, it is traditional to report errors by raising exceptions. You can enable this behavior in GDAL and OGR by calling the <code class="docutils literal notranslate"><span class="pre">UseExceptions()</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gdal</span><span class="o">.</span><span class="n">UseExceptions</span><span class="p">()</span>    <span class="c1"># Enable exceptions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gdal</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">foo.img&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">RuntimeError</span>: <span class="n">&#39;C:\foo.img&#39; does not exist in the file system,</span>
<span class="x">and is not recognized as a supported dataset name.</span>

<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>It is planned that exceptions will be enabled by default in GDAL 4.0. Code that does not want exceptions to be raised in a future version of GDAL should explicitly disable them with <code class="docutils literal notranslate"><span class="pre">gdal.DontUseExceptions()</span></code>.</p>
</div>
</section>
<section id="python-crashes-or-throws-an-exception-if-you-use-an-object-after-deleting-a-related-object">
<h3>Python crashes or throws an exception if you use an object after deleting a related object<a class="headerlink" href="#python-crashes-or-throws-an-exception-if-you-use-an-object-after-deleting-a-related-object" title="Link to this heading"></a></h3>
<p>Consider this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">RandomData.img&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">band</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">band</span><span class="o">.</span><span class="n">Checksum</span><span class="p">())</span>
<span class="go">31212</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">band</span></code> has a relationship with <code class="docutils literal notranslate"><span class="pre">dataset</span></code> that requires <code class="docutils literal notranslate"><span class="pre">dataset</span></code> to remain allocated in order for <code class="docutils literal notranslate"><span class="pre">band</span></code> to work.
If we delete <code class="docutils literal notranslate"><span class="pre">dataset</span></code> and then try to use <code class="docutils literal notranslate"><span class="pre">band</span></code>, Python will throw a confusing exception:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">RandomData.img&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">band</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">dataset</span>           <span class="c1"># This will cause the Python garbage collector to deallocate dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">band</span><span class="o">.</span><span class="n">Checksum</span><span class="p">()</span>       <span class="c1"># This will throw an exception because the band&#39;s dataset is gone</span>
<span class="go"># TypeError: in method &#39;Band_Checksum&#39;, argument 1 of type &#39;GDALRasterBandShadow *&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>In GDAL 3.7 and earlier, using a band after the dataset has been destroyed will cause a crash instead of an exception.</p>
</div>
<p>This problem can manifest itself in subtle ways. For example, it can occur if you try to instantiate a temporary dataset instance within a single line of code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">RandomData.img&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">Checksum</span><span class="p">())</span>
<span class="go"># TypeError: in method &#39;Band_Checksum&#39;, argument 1 of type &#39;GDALRasterBandShadow *&#39;</span>
</pre></div>
</div>
<p>In this example, the dataset instance was no longer needed after the call to <code class="docutils literal notranslate"><span class="pre">GetRasterBand()</span></code> so Python deallocated it <em>before</em> calling <code class="docutils literal notranslate"><span class="pre">Checksum()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">load_band</span><span class="p">(</span><span class="n">data_filename</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">dataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">band</span> <span class="o">=</span> <span class="n">load_band</span><span class="p">(</span><span class="s1">&#39;c:</span><span class="se">\\</span><span class="s1">RandomData.img&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">band</span><span class="o">.</span><span class="n">Checksum</span><span class="p">())</span>
<span class="go"># TypeError: in method &#39;Band_Checksum&#39;, argument 1 of type &#39;GDALRasterBandShadow *&#39;</span>
</pre></div>
</div>
<p>This example is the same case as above but it looks different. The dataset
object is only available in the <code class="docutils literal notranslate"><span class="pre">load_band</span></code> function and will be deleted
right after leaving the function.</p>
<p>The problem is not restricted to GDAL band and dataset objects and happens in
other areas where objects have relationships with each other. The issue occurs
because deleting an object in Python causes not only the C++ object behind it
to be deallocated, but also other objects for which that C++ object maintains
ownership (e.g., a Dataset owning a Band, a Feature owning a Geometry.) If the
Python object associated with one of these child objects retains a reference to
that object, Python will crash when the object is accessed. In common cases
such as the Band/Dataset relationship above, the GDAL bindings invalidate
references to objects that no longer exist so that an exception is thrown
instead of a crash, but the work is not complete.</p>
<p>Unfortunately there is no complete list of such relationships, so you have to watch for it yourself.</p>
</section>
<section id="python-crashes-if-you-add-a-new-field-to-an-ogr-layer-when-features-deriving-from-this-layer-definition-are-still-active">
<h3>Python crashes if you add a new field to an OGR layer when features deriving from this layer definition are still active<a class="headerlink" href="#python-crashes-if-you-add-a-new-field-to-an-ogr-layer-when-features-deriving-from-this-layer-definition-are-still-active" title="Link to this heading"></a></h3>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feature</span> <span class="o">=</span> <span class="n">lyr</span><span class="o">.</span><span class="n">GetNextFeature</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">field_defn</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lyr</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">field_defn</span><span class="p">)</span>                       <span class="c1"># now, existing features deriving from this layer are invalid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature</span><span class="o">.</span><span class="n">DumpReadable</span><span class="p">()</span>                            <span class="c1"># segfault</span>
<span class="go">&lt; Python crashes &gt;</span>
</pre></div>
</div>
<p>For more information, please see <a class="reference external" href="https://trac.osgeo.org/gdal/ticket/3552">#3552</a>.</p>
</section>
<section id="layers-with-attribute-filters-setattributefilter-will-only-return-filtered-features-when-using-getnextfeature">
<h3>Layers with attribute filters (<code class="docutils literal notranslate"><span class="pre">SetAttributeFilter()</span></code>) will only return filtered features when using <code class="docutils literal notranslate"><span class="pre">GetNextFeature()</span></code><a class="headerlink" href="#layers-with-attribute-filters-setattributefilter-will-only-return-filtered-features-when-using-getnextfeature" title="Link to this heading"></a></h3>
<p>If you read the documentation for <code class="docutils literal notranslate"><span class="pre">SetAttributeFilter()</span></code> carefully you will see the caveat about <code class="docutils literal notranslate"><span class="pre">OGR_L_GetNextFeature()</span></code>.
This means that if you use <code class="docutils literal notranslate"><span class="pre">GetFeature()</span></code>, instead of <code class="docutils literal notranslate"><span class="pre">GetNextFeature()</span></code>, then you can still access and work with features from the layer that are not covered by the filter.
<code class="docutils literal notranslate"><span class="pre">GetFeatureCount()</span></code> will respect the filter and show the correct number of features filtered. However, working with <code class="docutils literal notranslate"><span class="pre">GetFeatureCount()</span></code> in a loop can lead to some subtle confusion.
Iterating over the Layer object or using <code class="docutils literal notranslate"><span class="pre">GetNextFeature()</span></code> should be the default method for accessing features:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lyr</span> <span class="o">=</span> <span class="n">inDataSource</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lyr</span><span class="o">.</span><span class="n">SetAttributeFilter</span><span class="p">(</span><span class="s2">&quot;PIN = &#39;0000200001&#39;&quot;</span><span class="p">)</span>      <span class="c1"># this is a unique filter for only one record</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lyr</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">()</span> <span class="p">):</span>
<span class="gp">... </span>   <span class="n">feat</span> <span class="o">=</span> <span class="n">lyr</span><span class="o">.</span><span class="n">GetFeature</span><span class="p">(</span> <span class="n">i</span> <span class="p">)</span>
<span class="gp">... </span>   <span class="nb">print</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>                                    <span class="c1"># this will print one feat, but it&#39;s the first feat in the Layer and not the filtered feat</span>
<span class="gp">...</span>
</pre></div>
</div>
</section>
<section id="certain-objects-contain-a-destroy-method-but-you-should-never-use-it">
<h3>Certain objects contain a <code class="docutils literal notranslate"><span class="pre">Destroy()</span></code> method, but you should never use it<a class="headerlink" href="#certain-objects-contain-a-destroy-method-but-you-should-never-use-it" title="Link to this heading"></a></h3>
<p>You may come across examples that call the <code class="docutils literal notranslate"><span class="pre">Destroy()</span></code> method. <a class="reference external" href="https://www.gis.usu.edu/~chrisg/python/2009/lectures/ospy_slides2.pdf">This tutorial</a> even gives specific advice on page 12 about when to call <code class="docutils literal notranslate"><span class="pre">Destroy</span></code>.</p>
<p>Calling <code class="docutils literal notranslate"><span class="pre">Destroy</span></code> forces the underlying native object to be destroyed.  This
is typically unnecessary because these objects are automatically destroyed
during garbage collection when no references to the Python object remain.</p>
<p>In most situations, it is not necessary to force the object to be destroyed
at a specific point in time. However, because the contents of <code class="docutils literal notranslate"><span class="pre">gdal.Dataset</span></code> and
<code class="docutils literal notranslate"><span class="pre">ogr.DataSource</span></code> objects are only guaranteed to be written to disk when
the backing native object is destroyed, it may be necessary to explicitly destroy
these objects. In these cases, a context manager (<code class="docutils literal notranslate"><span class="pre">with</span></code> block) is often a
good solution, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">ogr</span>
<span class="k">with</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">CreateDataSource</span><span class="p">(</span><span class="s2">&quot;/tmp/test.shp&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">lyr</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="n">feat</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">())</span>
    <span class="n">feat</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkt</span><span class="p">(</span><span class="s1">&#39;POINT (1 2)&#39;</span><span class="p">)</span>
    <span class="n">lyr</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
<span class="c1"># contents of ds are written to disk</span>
</pre></div>
</div>
<p>If this is not possible, for example if the object needs to be destroyed within a
function, then the <code class="docutils literal notranslate"><span class="pre">Close()</span></code> method may be called.</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>Context managers and the <code class="docutils literal notranslate"><span class="pre">Close()</span></code> method are available beginning in GDAL 3.8.
In earlier versions, <code class="docutils literal notranslate"><span class="pre">Destroy()</span></code> can be used for <code class="docutils literal notranslate"><span class="pre">ogr.DataSource</span></code> objects,
or garbage collection may be forced by destroying reference using <code class="docutils literal notranslate"><span class="pre">del</span></code> or setting
variables to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<p>With some drivers, raster datasets can be intermittently saved without closing
using <code class="docutils literal notranslate"><span class="pre">FlushCache()</span></code>. Similarly, vector datasets can be saved using
<code class="docutils literal notranslate"><span class="pre">SyncToDisk()</span></code>.  However, neither of these methods guarantee that the data
are written to disk, so the preferred method is to use a context manager
or call <code class="docutils literal notranslate"><span class="pre">Close()</span></code>.</p>
</section>
<section id="exceptions-raised-in-custom-error-handlers-do-not-get-caught">
<h3>Exceptions raised in custom error handlers do not get caught<a class="headerlink" href="#exceptions-raised-in-custom-error-handlers-do-not-get-caught" title="Link to this heading"></a></h3>
<p>The python bindings allow you to specify a python callable as an error handler (<a class="reference external" href="https://trac.osgeo.org/gdal/ticket/4993">#4993</a>).
However, these error handlers appear to be called in a separate thread and any exceptions raised do not propagate back to the main thread (<a class="reference external" href="https://trac.osgeo.org/gdal/ticket/5186">#5186</a>).</p>
<p>So if you want to  <a class="reference external" href="https://gis.stackexchange.com/questions/43404/how-to-detect-a-gdal-ogr-warning/68042">catch warnings as well as errors</a>, something like this won't work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>

<span class="k">def</span> <span class="nf">error_handler</span><span class="p">(</span><span class="n">err_level</span><span class="p">,</span> <span class="n">err_no</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">err_level</span> <span class="o">&gt;=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">CE_Warning</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">err_level</span><span class="p">,</span> <span class="n">err_no</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">)</span>  <span class="c1"># this exception does not propagate back to main thread!</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Test custom error handler</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">PushErrorHandler</span><span class="p">(</span><span class="n">error_handler</span><span class="p">)</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">gdal</span><span class="o">.</span><span class="n">CE_Warning</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;test warning message&#39;</span><span class="p">)</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">PopErrorHandler</span><span class="p">()</span>
</pre></div>
</div>
<p>But you can do something like this instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>

<span class="k">class</span> <span class="nc">GdalErrorHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_level</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">CE_None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_no</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">err_level</span><span class="p">,</span> <span class="n">err_no</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_level</span> <span class="o">=</span> <span class="n">err_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_no</span> <span class="o">=</span> <span class="n">err_no</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_msg</span> <span class="o">=</span> <span class="n">err_msg</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">GdalErrorHandler</span><span class="p">()</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">PushErrorHandler</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">handler</span><span class="p">)</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">UseExceptions</span><span class="p">()</span>  <span class="c1"># Exceptions will get raised on anything &gt;= gdal.CE_Failure</span>

    <span class="k">assert</span> <span class="n">err</span><span class="o">.</span><span class="n">err_level</span> <span class="o">==</span> <span class="n">gdal</span><span class="o">.</span><span class="n">CE_None</span><span class="p">,</span> <span class="s1">&#39;the error level starts at 0&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Demonstrate handling of a warning message</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gdal</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">gdal</span><span class="o">.</span><span class="n">CE_Warning</span><span class="p">,</span> <span class="mi">8675309</span><span class="p">,</span> <span class="s1">&#39;Test warning message&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;Operation raised an exception, this should not happen&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">err</span><span class="o">.</span><span class="n">err_level</span> <span class="o">==</span> <span class="n">gdal</span><span class="o">.</span><span class="n">CE_Warning</span><span class="p">,</span> <span class="p">(</span>
                <span class="s1">&#39;The handler error level should now be at warning&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Handled error: level=</span><span class="si">{}</span><span class="s1">, no=</span><span class="si">{}</span><span class="s1">, msg=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">err</span><span class="o">.</span><span class="n">err_level</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">err_no</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">err_msg</span><span class="p">))</span>

        <span class="c1"># Demonstrate handling of an error message</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gdal</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">gdal</span><span class="o">.</span><span class="n">CE_Failure</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;Test error message&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">err</span><span class="o">.</span><span class="n">err_level</span> <span class="o">==</span> <span class="n">gdal</span><span class="o">.</span><span class="n">CE_Failure</span><span class="p">,</span> <span class="p">(</span>
                <span class="s1">&#39;The handler error level should now be at failure&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">err</span><span class="o">.</span><span class="n">err_msg</span> <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;raised exception should contain the message&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Handled warning: level=</span><span class="si">{}</span><span class="s1">, no=</span><span class="si">{}</span><span class="s1">, msg=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">err</span><span class="o">.</span><span class="n">err_level</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">err_no</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">err_msg</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;Error message was not raised, this should not happen&#39;</span><span class="p">)</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="n">gdal</span><span class="o">.</span><span class="n">PopErrorHandler</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="gotchas-that-result-from-bugs-or-behaviors-of-other-software">
<h2>Gotchas that result from bugs or behaviors of other software<a class="headerlink" href="#gotchas-that-result-from-bugs-or-behaviors-of-other-software" title="Link to this heading"></a></h2>
<section id="python-crashes-in-gdal-functions-when-you-upgrade-or-downgrade-numpy">
<h3>Python crashes in GDAL functions when you upgrade or downgrade numpy<a class="headerlink" href="#python-crashes-in-gdal-functions-when-you-upgrade-or-downgrade-numpy" title="Link to this heading"></a></h3>
<p>Much of GDAL's Python bindings are implemented in C++. Much of the core of numpy is implemented in C. The C++ part of GDAL's Python bindings interacts with the C part of numpy through numpy's ABI (application binary interface).
This requires GDAL's Python bindings to be compiled using numpy header files that define numpy C data structures. Those data structures sometimes change between numpy versions. When this happens, the new version of numpy is not be compatible at the binary level with the old version, and the GDAL Python bindings must be recompiled before they will work with the new version of numpy.
And when they are recompiled, they probably won't work with the old version.</p>
<p>If you obtained a precompiled version of GDAL's Python bindings, such as the Windows packages from <a class="reference external" href="http://gisinternals.com/sdk.php">http://gisinternals.com/sdk.php</a> be sure you look up what version of numpy was used to compile them, and install that version of numpy on your machine.</p>
</section>
<section id="python-bindings-cannot-be-used-successfully-from-arcgis-in-process-geoprocessing-tools-arcgis-9-3-and-later">
<h3>Python bindings cannot be used successfully from ArcGIS in-process geoprocessing tools (ArcGIS 9.3 and later)<a class="headerlink" href="#python-bindings-cannot-be-used-successfully-from-arcgis-in-process-geoprocessing-tools-arcgis-9-3-and-later" title="Link to this heading"></a></h3>
<p>ArcGIS allows the creation of custom, Python-based geoprocessing tools. Until ArcGIS 10, there was no easy way to read raster data into memory. GDAL provides such a mechanism.</p>
<p>Starting with ArcGIS 9.3, geoprocessing tools can either run in the ArcGIS process itself (ArcCatalog.exe or ArcMap.exe) or run in a separate python.exe worker process. Unfortunately ArcGIS contains a bug in how it runs in-process tools. Thus, if you use GDAL from an in-process tool, it will run fine the first time but after that it may fail with <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> exceptions until you restart the ArcGIS process. For example, band.ReadAsArray() fails with:</p>
<p><code class="docutils literal notranslate"><span class="pre">TypeError:</span> <span class="pre">in</span> <span class="pre">method</span> <span class="pre">'BandRasterIONumpy',</span> <span class="pre">argument</span> <span class="pre">1</span> <span class="pre">of</span> <span class="pre">type</span> <span class="pre">'GDALRasterBandShadow</span> <span class="pre">*</span></code>'</p>
<p>This is a bug in ArcGIS. Please see <a class="reference external" href="https://trac.osgeo.org/gdal/ticket/3672">#3672</a> for complete details and advice on workarounds.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="python_samples.html" class="btn btn-neutral float-right" title="Python Sample scripts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="python/osgeo.osr.html" class="btn btn-neutral float-left" title="osgeo.osr module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <div class="info">
      <a class="logo-link" href="https://osgeo.org">
        <div class="osgeo-logo"></div>
      </a>
      <div class="copyright">
      

      &copy; 1998-2024 <a href="https://github.com/warmerdam">Frank Warmerdam</a>,
      <a href="https://github.com/rouault">Even Rouault</a>, and
      <a href="https://github.com/OSGeo/gdal/graphs/contributors">others</a>


      
      </div>
    </div>
  </div>
</footer>
        </div>
      </div>
    </section>
  </div>
  
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>