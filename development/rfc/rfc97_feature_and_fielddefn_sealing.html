<!DOCTYPE html>
<html class="writer-html5" lang="ja" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RFC 97: OGRFeatureDefn, OGRFieldDefn and OGRGeomFieldDefn &#34;sealing&#34; &mdash; GDAL  ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/gdal.css?v=e152ac3b" />

  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="canonical" href="https://gdal.org/development/rfc/rfc97_feature_and_fielddefn_sealing.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=c033477b"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/translations.js?v=91613774"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="このドキュメントについて" href="../../about.html" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="RFC 98: Build requirements for GDAL 3.9" href="rfc98_build_requirements_gdal_3_9.html" />
    <link rel="prev" title="RFC 96: Deferred C++ plugin loading" href="rfc96_deferred_plugin_loading.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/gdalicon.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../download.html">ダウンロード</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programs/index.html">プログラム</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers/raster/index.html">ラスタードライバー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers/vector/index.html">ベクタードライバー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">ユーザー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">チュートリアル</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">開発</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../building_from_source.html">Building GDAL from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev_environment.html">Setting up a development environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev_practices.html">Development practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html">Automated testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev_documentation.html">Building documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmake.html">Using GDAL in CMake projects</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">RFC list</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="rfc1_pmc.html">RFC 1: Project Management Committee Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc2_svn.html">RFC 2: Migration to OSGeo Subversion Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc3_commiters.html">RFC 3: GDAL Committer Guildlines</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc4_geolocate.html">RFC 4: Geolocation Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc5_unicode.html">RFC 5: Unicode support in GDAL</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc6_sqlgeom.html">RFC 6: Geometry and Feature Style as OGR Special Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc7_vsilapi.html">RFC 7: Use VSILFILE for VSI*L Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc8_devguide.html">RFC 8: Developer Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc9_maintainer.html">RFC 9: GDAL Paid Maintainer Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc10_ogropen.html">RFC 10: OGR Open Parameters (not implemented)</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc11_fastidentify.html">RFC 11: Fast Format Identification</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc12_filemanagement.html">RFC 12: Improved File Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc13_createfeatures.html">RFC 13: Improved Feature Insertion/Update/Delete Performance in Batch Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc14_imagestructure.html">RFC 14: Image Structure Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc15_nodatabitmask.html">RFC 15: Band Masks</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc16_ogr_reentrancy.html">RFC 16: OGR Thread Safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc17_python_namespaces.html">RFC 17: Python Namespaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc18_ogr_styles_c_api.html">RFC 18: OGR Style Support in C API</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc19_safememalloc.html">RFC 19: Safer memory allocation in GDAL</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc20_srs_axes.html">RFC 20: OGRSpatialReference Axis Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc21_ogrsqlcast.html">RFC 21: OGR SQL type cast and field name alias</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc22_rpc.html">RFC 22: RPC Georeferencing</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc23_ogr_unicode.html">RFC 23.1: Unicode support in OGR</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc24_progressive_data_support.html">RFC 24: GDAL Progressive Data Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc25_fast_open.html">RFC 25: Fast Open (withdrawn)</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc26_blockcache.html">RFC 26: GDAL Block Cache Improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc27_supportdata.html">RFC 27: Improved Supporting Data File Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc28_sqlfunc.html">RFC 28: OGR SQL Generalized Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc29_desired_fields.html">RFC 29: OGR Set Ignored Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc30_utf8_filenames.html">RFC 30: Unicode Filenames</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc31_ogr_64.html">RFC 31: OGR 64bit Integer Fields and FIDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc32_gdallocationinfo.html">RFC 32: gdallocationinfo utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc33_gtiff_pixelispoint.html">RFC 33: GTiff - Fixing PixelIsPoint Interpretation</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc34_license_policy.html">RFC 34: License Policy Enforcement</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc35_deletereorderalterfielddefn.html">RFC 35: Delete, reorder and alter field definitions of OGR layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc36_open_by_drivername.html">RFC 36: Allow specification of intended driver on GDALOpen (withdrawn)</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc37_cplerror_userdata.html">RFC 37: User data callbacks in CPLError</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc38_ogr_faster_open.html">RFC 38: OGR Faster Open (withdrawn)</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc39_ogr_layer_algebra.html">RFC 39: OGR Layer Algebra</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc40_enhanced_rat_support.html">RFC 40: Improving performance of Raster Attribute Table implementation for large tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc41_multiple_geometry_fields.html">RFC 41 : Support for multiple geometry fields in OGR</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc42_find_laundered_fields.html">RFC 42: OGR Layer laundered field lookup</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc43_getmetadatadomainlist.html">RFC 43: GDALMajorObject::GetMetadataDomainList</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc44_gdalinfoxml.html">RFC 44: Add Parseable Output Formats for ogrinfo and gdalinfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc45_virtualmem.html">RFC 45: GDAL datasets and raster bands as virtual memory mappings</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc46_gdal_ogr_unification.html">RFC 46: GDAL/OGR unification</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc47_dataset_caching.html">RFC 47: Per Dataset Caching and GDALRasterBand Multithreading (not implemented)</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc48_geographical_networks_support.html">RFC 48: Geographical networks support</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc49_curve_geometries.html">RFC 49: Curve geometries</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc50_ogr_field_subtype.html">RFC 50: OGR field subtypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc51_rasterio_resampling_progress.html">RFC 51: RasterIO() improvements : resampling and progress callback</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc52_strict_sql_quoting.html">RFC 52: Strict OGR SQL quoting</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc53_ogr_notnull_default.html">RFC 53: OGR not-null constraints and default values</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc54_dataset_transactions.html">RFC 54: Dataset transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc55_refined_setfeature_deletefeature_semantics.html">RFC 55: Refined SetFeature() and DeleteFeature() semantics</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc56_millisecond_precision.html">RFC 56: OFTTime/OFTDateTime millisecond accuracy</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc57_histogram_64bit_count.html">RFC 57: 64-bit bucket counts for histograms</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc58_removing_dataset_nodata_value.html">RFC 58: Removing Dataset Nodata Value</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc59.1_utilities_as_a_library.html">RFC 59.1 : GDAL/OGR utilities as a library</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc59_utilities_as_a_library.html">RFC 59 : GDAL/OGR utilities as a library</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc60_improved_roundtripping_in_ogr.html">RFC 60 : Improved round-tripping in OGR</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc61_support_for_measured_geometries.html">RFC 61 : Support for measured geometries</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc62_raster_algebra.html">RFC 62 : Raster algebra</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc63_sparse_datasets_improvements.html">RFC 63 : Sparse datasets improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc64_triangle_polyhedralsurface_tin.html">RFC 64: Triangle, Polyhedral surface and TIN</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc65_rfc7946_geojson.html">RFC 65: RFC 7946 GeoJSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc66_randomlayerreadwrite.html">RFC 66 : OGR random layer read/write capabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc67_nullfieldvalues.html">RFC 67 : Null values in OGR</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc68_cplusplus11.html">RFC 68: C++11 Compilation Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc69_cplusplus_formatting.html">RFC 69: C/C++ Code Formatting</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc70_output_format_guess.html">RFC 70: Guessing output format from output file name extension for utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc71_github_migration.html">RFC 71: Migration to GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc72_pytest.html">RFC 72: Update autotest suite to use pytest</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc73_proj6_wkt2_srsbarn.html">RFC 73: Integration of PROJ6 for WKT2, late binding capabilities, time-support and unified CRS database</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc74_sphinx.html">RFC 74: Migrate gdal.org to RTD-style Sphinx infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc75_multidimensional_arrays.html">RFC 75: Multidimensional arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc76_ogrpythondrivers.html">RFC 76: OGR Python drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc77_drop_python2_support.html">RFC 77: Drop Python 2 support in favour of Python 3.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc78_gdal_utils_package.html">RFC 78: gdal-utils package</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc79_listing_service_providers.html">RFC 79: Listing of Service Providers on GDAL website</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc80_numfocus_relationship.html">RFC 80: NumFOCUS relationship and sponsorship program</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc81_coordinate_epoch.html">RFC 81: Support for coordinate epochs in geospatial formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc83_use_of_project_sponsorship.html">RFC 83: guidelines for the use of GDAL project sponsorship</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc84_cmake.html">RFC 84: Migrating build systems to CMake</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc85_policy_code_additions.html">RFC 85: Policy regarding substantial code additions</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc86_column_oriented_api.html">RFC 86: Column-oriented read API for vector layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc87_signed_int8.html">RFC 87: Signed int8 data type for raster</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc88_googletest.html">RFC 88: Use GoogleTest framework for C/C++ unit tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc89_sql_logging_callback.html">RFC 89: SQL logging callback</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc90_read_compressed_data.html">RFC 90: Direct access to compressed raster data</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc91_dataset_close.html">RFC 91: GDALDataset::Close() method</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc92_wkb_only_geometries.html">RFC 92: WKB Only geometries (on hold)</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc93_update_feature.html">RFC 93: OGRLayer::UpdateFeature() method</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc94_field_precision_width_metadata.html">RFC 94: Numeric fields width/precision metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc95_standard_int_types.html">RFC 95: Use standard C/C++ integer types (proposed, <em>NOT</em> adopted)</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc96_deferred_plugin_loading.html">RFC 96: Deferred C++ plugin loading</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">RFC 97: OGRFeatureDefn, OGRFieldDefn and OGRGeomFieldDefn &quot;sealing&quot;</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#motivation">Motivation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#details">Details</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-of-a-typical-driver">Example of a typical driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="#discussion">Discussion</a></li>
<li class="toctree-l4"><a class="reference internal" href="#swig-bindings">SWIG bindings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#updated-drivers">Updated drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backward-compatibility">Backward compatibility</a></li>
<li class="toctree-l4"><a class="reference internal" href="#risks">Risks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#related-issues-and-prs">Related issues and PRs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#voting-history">Voting history</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rfc98_build_requirements_gdal_3_9.html">RFC 98: Build requirements for GDAL 3.9</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfc99_geometry_coordinate_precision.html">RFC 99: Geometry coordinate precision</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">コミュニティ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sponsors/index.html">スポンサー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">どのように貢献できますか?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">ライセンス</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GDAL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html"> GDAL  ドキュメント </a> &raquo;</li>
      
          <li><a href="../index.html">開発</a> &raquo;</li>
      
          <li><a href="index.html">RFC list</a> &raquo;</li>
      
      <li>RFC 97: OGRFeatureDefn, OGRFieldDefn and OGRGeomFieldDefn &quot;sealing&quot;</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSGeo/gdal/edit/master/doc/source/development/rfc/rfc97_feature_and_fielddefn_sealing.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="rfc98_build_requirements_gdal_3_9.html" class="btn btn-neutral float-right" title="RFC 98: Build requirements for GDAL 3.9" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rfc96_deferred_plugin_loading.html" class="btn btn-neutral float-left" title="RFC 96: Deferred C++ plugin loading" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rfc-97-ogrfeaturedefn-ogrfielddefn-and-ogrgeomfielddefn-sealing">
<span id="rfc-97"></span><h1>RFC 97: OGRFeatureDefn, OGRFieldDefn and OGRGeomFieldDefn &quot;sealing&quot;<a class="headerlink" href="#rfc-97-ogrfeaturedefn-ogrfielddefn-and-ogrgeomfielddefn-sealing" title="Link to this heading"></a></h1>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Author:</p></td>
<td><p>Even Rouault</p></td>
</tr>
<tr class="row-even"><td><p>Contact:</p></td>
<td><p>even.rouault &#64; spatialys.com</p></td>
</tr>
<tr class="row-odd"><td><p>Started:</p></td>
<td><p>2023-Nov-16</p></td>
</tr>
<tr class="row-even"><td><p>Status:</p></td>
<td><p>Adopted, implemented</p></td>
</tr>
<tr class="row-odd"><td><p>Target:</p></td>
<td><p>GDAL 3.9</p></td>
</tr>
</tbody>
</table>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h2>
<p>This RFC aims at avoiding common misuse of the setter methods of the
OGRFeatureDefn, OGRFieldDefn and OGRGeomFieldDefn classes. Indeed, the setter
methods of those classes should not be used directly by user code (that is
non driver implementations), on instances that are owned by a OGRLayer. It is
quite frequent for users (even seasoned ones) to neglect that constraint. Hence
this RFC introduces an optional &quot;sealing&quot; capability that drivers can enable to
avoid users modifying instances that they should not.</p>
</section>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading"></a></h2>
<p>Let's take an example to clarify. We want to prevent a user from doing the
following:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">iFieldIdx</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">SetName</span><span class="p">(</span><span class="s">&quot;new_name&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The above code will not raise any warning or error at runtime, but will not
change the underlying on-disk dataset to reflect the new field name.
Indeed poLayer-&gt;GetLayerDefn() and its child objects should be considered
immutable, unless using dedicated methods of OGRLayer to modify them.
The correct way of renaming an existing field is (for drivers that support such
capability):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFieldDefn</span><span class="w"> </span><span class="n">oRenamedField</span><span class="p">(</span><span class="s">&quot;new_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">iFieldIdx</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetType</span><span class="p">());</span>
<span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">AlterFieldDefn</span><span class="p">(</span><span class="n">iFieldIdx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">oRenamedField</span><span class="p">,</span><span class="w"> </span><span class="n">ALTER_NAME_FLAG</span><span class="p">);</span>
</pre></div>
</div>
<p>For other operations, such as calling <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRFieldDefn::AddFieldDefn()</span></code>
or <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRFieldDefn::DeleteFieldDefn()</span></code> on an instance of OGRLayer::GetLayerDefn(),
crashes could potentially occur in drivers that are not ready to see the number
of fields to change behind their back. The correct way of adding or deleting
fields to a layer is to use <a class="reference internal" href="../../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer11CreateFieldEPK12OGRFieldDefni" title="OGRLayer::CreateField"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::CreateField()</span></code></a> or
<a class="reference internal" href="../../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer11DeleteFieldEi" title="OGRLayer::DeleteField"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::DeleteField()</span></code></a></p>
</section>
<section id="details">
<h2>Details<a class="headerlink" href="#details" title="Link to this heading"></a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">m_bSealed</span></code> member variable is added to the
<a class="reference internal" href="../../api/ogrfeature_cpp.html#_CPPv412OGRFieldDefn" title="OGRFieldDefn"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">OGRFieldDefn</span></code></a> and <a class="reference internal" href="../../api/ogrfeature_cpp.html#_CPPv416OGRGeomFieldDefn" title="OGRGeomFieldDefn"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">OGRGeomFieldDefn</span></code></a> classes. Its default
value is false, meaning that calling setters method on instances of those classes
is allowed by default.</p>
<p>The following methods are added on <a class="reference internal" href="../../api/ogrfeature_cpp.html#_CPPv412OGRFieldDefn" title="OGRFieldDefn"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">OGRFieldDefn</span></code></a> (and similarly
for <a class="reference internal" href="../../api/ogrfeature_cpp.html#_CPPv416OGRGeomFieldDefn" title="OGRGeomFieldDefn"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">OGRGeomFieldDefn</span></code></a>)</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Seal a OGRFieldDefn.</span>
<span class="cm"> *</span>
<span class="cm"> * A sealed OGRFieldDefn can not be modified while it is sealed.</span>
<span class="cm"> *</span>
<span class="cm"> * This method should only be called by driver implementations.</span>
<span class="cm"> *</span>
<span class="cm"> * @since GDAL 3.9</span>
<span class="cm"> */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">OGRFieldDefn::Seal</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">m_bSealed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/** Unseal a OGRFieldDefn.</span>
<span class="cm"> *</span>
<span class="cm"> * Undo OGRFieldDefn::Seal()</span>
<span class="cm"> *</span>
<span class="cm"> * Using GetTemporaryUnsealer() is recommended for most use cases.</span>
<span class="cm"> *</span>
<span class="cm"> * This method should only be called by driver implementations.</span>
<span class="cm"> *</span>
<span class="cm"> * @since GDAL 3.9</span>
<span class="cm"> */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">OGRFieldDefn::Unseal</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">m_bSealed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>All setter methods of those classes are modified to check the value of
<code class="docutils literal notranslate"><span class="pre">m_bSealed</span></code>. If it is set, a CE_Failure CPLError() is emitted indicating that
the object is sealed. Unfortunately most setters return <code class="docutils literal notranslate"><span class="pre">void</span></code>, so there is
no way to advertise the error through an error code. However, when using the
Python bindings with exceptions enabled, a Python exception will be thrown.</p>
<p>A convenience method is also offered to use the Resource Acquisition Is Initialization (RAII)
paradygm to temporary unseal an instance, which is an operation that drivers
implementing AlterFieldDefn() / AlterGeomFieldDefn() will need to do on fields
they have priorly sealed.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Return an object that temporary unseals the OGRFieldDefn</span>
<span class="cm"> *</span>
<span class="cm"> * The returned object calls Unseal() initially, and when it is destroyed</span>
<span class="cm"> * it calls Seal().</span>
<span class="cm"> *</span>
<span class="cm"> * This method should only be called by driver implementations.</span>
<span class="cm"> *</span>
<span class="cm"> * @since GDAL 3.9</span>
<span class="cm"> */</span>
<span class="n">OGRFieldDefn</span><span class="o">::</span><span class="n">TemporaryUnsealer</span><span class="w"> </span><span class="nf">OGRFieldDefn::GetTemporaryUnsealer</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">TemporaryUnsealer</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Typical usage is by AlterFieldDefn() / AlterGeomFieldDefn() is:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRErr</span><span class="w"> </span><span class="nf">OGRPGTableLayer::AlterFieldDefn</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">iField</span><span class="p">,</span><span class="w"> </span><span class="n">OGRFieldDefn</span><span class="w"> </span><span class="o">*</span><span class="n">poNewFieldDefn</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nFlagsIn</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">OGRFieldDefn</span><span class="w"> </span><span class="o">*</span><span class="n">poFieldDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poFeatureDefn</span><span class="o">-&gt;</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">iField</span><span class="p">);</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">oTemporaryUnsealer</span><span class="p">(</span><span class="n">poFieldDefn</span><span class="o">-&gt;</span><span class="n">GetTemporaryUnsealer</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// modify poFieldDefn to reflect changed properties of poNewFieldDefn</span>
<span class="w">    </span><span class="c1">// according to nFlagsIn.</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For punctual changes, a convenience <code class="docutils literal notranslate"><span class="pre">whileUnsealing</span></code> function is also
provided.</p>
<p>It can be used as in the following:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">whileUnsealing</span><span class="p">(</span><span class="n">poFieldDefn</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">SetType</span><span class="p">(</span><span class="n">eNewType</span><span class="p">);</span>
</pre></div>
</div>
<p>For OGRFeatureDefn, similar changes are done but with an extra subtelty.
For convenience of drivers, we want a driver to be able to call GetTemporaryUnsealer()
in a nested way, where only the first/most external call does something, and
next/nested ones are a no-operation. This is similar to using a recursive mutex
from the same thread. The user can also indicate if it wishes fields and geometry
fields owned by the OGRFeatureDefn to be sealed/unsealed at the same time.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Seal a OGRFeatureDefn.</span>
<span class="cm"> *</span>
<span class="cm"> * A sealed OGRFeatureDefn can not be modified while it is sealed.</span>
<span class="cm"> *</span>
<span class="cm"> * This method also call OGRFieldDefn::Seal() and OGRGeomFieldDefn::Seal()</span>
<span class="cm"> * on its fields and geometry fields.</span>
<span class="cm"> *</span>
<span class="cm"> * This method should only be called by driver implementations.</span>
<span class="cm"> *</span>
<span class="cm"> * @param bSealFields Whether fields and geometry fields should be sealed.</span>
<span class="cm"> *                    This is generally desirabled, but in case of deferred</span>
<span class="cm"> *                    resolution of them, this parameter should be set to false.</span>
<span class="cm"> * @since GDAL 3.9</span>
<span class="cm"> */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">OGRFeatureDefn::Seal</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">bSealFields</span><span class="p">);</span>


<span class="cm">/** Unseal a OGRFeatureDefn.</span>
<span class="cm"> *</span>
<span class="cm"> * Undo OGRFeatureDefn::Seal()</span>
<span class="cm"> *</span>
<span class="cm"> * This method also call OGRFieldDefn::Unseal() and OGRGeomFieldDefn::Unseal()</span>
<span class="cm"> * on its fields and geometry fields.</span>
<span class="cm"> *</span>
<span class="cm"> * Using GetTemporaryUnsealer() is recommended for most use cases.</span>
<span class="cm"> *</span>
<span class="cm"> * This method should only be called by driver implementations.</span>
<span class="cm"> *</span>
<span class="cm"> * @param bUnsealFields Whether fields and geometry fields should be unsealed.</span>
<span class="cm"> *                      This is generally desirabled, but in case of deferred</span>
<span class="cm"> *                      resolution of them, this parameter should be set to</span>
<span class="cm"> * false.</span>
<span class="cm"> * @since GDAL 3.9</span>
<span class="cm"> */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">OGRFeatureDefn::Unseal</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">bUnsealFields</span><span class="p">);</span>

<span class="cm">/** Return an object that temporary unseals the OGRFeatureDefn</span>
<span class="cm"> *</span>
<span class="cm"> * The returned object calls Unseal() initially, and when it is destroyed</span>
<span class="cm"> * it calls Seal().</span>
<span class="cm"> * This method should be called on a OGRFeatureDefn that has been sealed</span>
<span class="cm"> * previously.</span>
<span class="cm"> * GetTemporaryUnsealer() calls may be nested, in which case only the first</span>
<span class="cm"> * one has an effect (similarly to a recursive mutex locked in a nested way</span>
<span class="cm"> * from the same thread).</span>
<span class="cm"> *</span>
<span class="cm"> * This method should only be called by driver implementations.</span>
<span class="cm"> *</span>
<span class="cm"> * @param bSealFields Whether fields and geometry fields should be unsealed and</span>
<span class="cm"> *                    resealed.</span>
<span class="cm"> *                    This is generally desirabled, but in case of deferred</span>
<span class="cm"> *                    resolution of them, this parameter should be set to false.</span>
<span class="cm"> * @since GDAL 3.9</span>
<span class="cm"> */</span>
<span class="n">OGRFeatureDefn</span><span class="o">::</span><span class="n">TemporaryUnsealer</span>
<span class="nf">OGRFeatureDefn::GetTemporaryUnsealer</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">bSealFields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>For punctual changes, a convenience <code class="docutils literal notranslate"><span class="pre">whileUnsealing</span></code> function is also
provided.</p>
<p>In practice, the only Seal() invocation in driver core should be done on
the OGRFeatureDefn instance they return with GetLayerDefn(). All subsequent
sealing/unsealing operations should be done through
OGRFeatureDefn::GetTemporaryUnsealer()</p>
</section>
<section id="example-of-a-typical-driver">
<h2>Example of a typical driver<a class="headerlink" href="#example-of-a-typical-driver" title="Link to this heading"></a></h2>
<p>Constructor of the OGRLayer subclass:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRMyLayer</span><span class="o">::</span><span class="n">OGRMyLayer</span><span class="p">(...)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">m_poFeatureDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OGRFeatureDefn</span><span class="p">(</span><span class="s">&quot;layer_name&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_poFeatureDefn</span><span class="o">-&gt;</span><span class="n">Reference</span><span class="p">();</span>
<span class="w">    </span><span class="n">SetDescription</span><span class="p">(</span><span class="n">m_poFeatureDefn</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">());</span>
<span class="w">    </span><span class="p">...</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">m_poFeatureDefn</span><span class="o">-&gt;</span><span class="n">AddFieldDefn</span><span class="p">()</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="n">m_poFeatureDefn</span><span class="o">-&gt;</span><span class="n">Seal</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Simple CreateField() implementation:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRErr</span><span class="w"> </span><span class="nf">OGRMyLayer::CreateField</span><span class="p">(</span><span class="n">OGRFieldDefn</span><span class="o">*</span><span class="w"> </span><span class="n">poNewFieldDefn</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bApproxOK</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">whileUnsealing</span><span class="p">(</span><span class="n">m_poFeatureDefn</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">AddFieldDefn</span><span class="p">(</span><span class="n">poNewFieldDefn</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">OGRERR_NONE</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Link to this heading"></a></h2>
<ul>
<li><p>Why not just having a <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">OGRFeatureDefn*</span> <span class="pre">OGRLayer::GetLayerDefn()</span> <span class="pre">const</span></code>
method ?</p>
<p>That would only work when using the C++ API (and would require changes in all
drivers to modify the signature, as well as doing changes at places where
drivers require a non-const OGRFeatureDefn*), because const correctness is not
available in the C API and the SWIG bindings.</p>
</li>
</ul>
</section>
<section id="swig-bindings">
<h2>SWIG bindings<a class="headerlink" href="#swig-bindings" title="Link to this heading"></a></h2>
<p>No impact. Those C++ methods are intended to be used by driver implementation
only.</p>
</section>
<section id="updated-drivers">
<h2>Updated drivers<a class="headerlink" href="#updated-drivers" title="Link to this heading"></a></h2>
<p>For the initial implementation, the following drivers are updated to seal their
layer definition:
GeoPackage, PostgreSQL, Shapefile, OpenFileGDB, MITAB, Memory, GeoJSON, JSONFG,
TopoJSON, ESRIJSON, ODS, XLSX.</p>
</section>
<section id="backward-compatibility">
<h2>Backward compatibility<a class="headerlink" href="#backward-compatibility" title="Link to this heading"></a></h2>
<p>C API is unchanged. Backwards compatible addition to the C++ API (ABI change)</p>
<p>There is the possibility to break user code that mis-used the API. For example,
this was the case of a few tests in the autotest suite that have had to be
modified.</p>
<p>MIGRATION_GUIDE.TXT will mention that and point to this RFC.</p>
</section>
<section id="risks">
<h2>Risks<a class="headerlink" href="#risks" title="Link to this heading"></a></h2>
<p>Drivers that implement sealing should make sure they unseal at the appropriate
places: OGRLayer::Rename(), CreateField(), DeleteField(), CreateGeomField(),
DeleteGeomField(), ReorderFields(), AlterFieldDefn() AlterGeomFieldDefn()
and any other places where they might modify objects.
Failure to do so will result in failures, and potentially crashes. Hence
implementation of sealing should only be done on drivers that have sufficient
test coverage.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading"></a></h2>
<p>The documentation of the setters as well as the introduction text of
OGRFeatureDefn, OGRFieldDefn and OGRGeomFieldDefn is modified to reflect that
setters of those classes should not be called on instances returned by
OGRLayer::GetLayerDefn().</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>The autotest suite is modified to comply with sealing</p></li>
<li><p>Calls to setters on sealed instances will be done to test that an error
is triggered.</p></li>
</ul>
</section>
<section id="related-issues-and-prs">
<h2>Related issues and PRs<a class="headerlink" href="#related-issues-and-prs" title="Link to this heading"></a></h2>
<p>Candidate implementation in <a class="reference external" href="https://github.com/OSGeo/gdal/pull/8733">https://github.com/OSGeo/gdal/pull/8733</a></p>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading"></a></h2>
<p>+1 from PSC members JukkaR, JavierJS and EvenR</p>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rfc98_build_requirements_gdal_3_9.html" class="btn btn-neutral float-right" title="RFC 98: Build requirements for GDAL 3.9" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rfc96_deferred_plugin_loading.html" class="btn btn-neutral float-left" title="RFC 96: Deferred C++ plugin loading" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <div class="info">
      <a class="logo-link" href="https://osgeo.org">
        <div class="osgeo-logo"></div>
      </a>
      <div class="copyright">
      

      &copy; 1998-2024 <a href="https://github.com/warmerdam">Frank Warmerdam</a>,
      <a href="https://github.com/rouault">Even Rouault</a>, and
      <a href="https://github.com/OSGeo/gdal/graphs/contributors">others</a>


      
      </div>
    </div>
  </div>
</footer>
        </div>
      </div>
    </section>
  </div>
  
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>