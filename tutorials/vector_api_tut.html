<!DOCTYPE html>
<html class="writer-html5" lang="ja" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ベクターAPIチュートリアル &mdash; GDAL  ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../_static/css/gdal.css?v=e152ac3b" />

  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="canonical" href="https://gdal.org/tutorials/vector_api_tut.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=c033477b"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=91613774"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="ベクタードライバー実装チュートリアル" href="vector_driver_tut.html" />
    <link rel="prev" title="多次元ラスタAPIチュートリアル" href="multidimensional_api_tut.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../index.html">
            
              <img src="../_static/gdalicon.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../download.html">ダウンロード</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/index.html">プログラム</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers/raster/index.html">ラスタードライバー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers/vector/index.html">ベクタードライバー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">ユーザー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">チュートリアル</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#raster">ラスター</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#multidimensional-raster">多次元ラスター</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#vector">ベクター</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">ベクターAPIチュートリアル</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reading-from-ogr">OGRからの読み込み</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reading-from-ogr-using-the-arrow-c-stream-data-interface">Arrow C Streamデータインターフェースを使用してOGRから読み込む</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-to-ogr">OGRへの書き込み</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-to-ogr-using-the-arrow-c-data-interface">Arrow Cデータインターフェースを使用してOGRに書き込む</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="vector_driver_tut.html">ベクタードライバー実装チュートリアル</a></li>
<li class="toctree-l3"><a class="reference internal" href="vector_python_driver.html">Vector driver in Python implementation tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#geographic-network-model">ジオグラフィックネットワークモデル</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#projections-and-spatial-reference-systems-tutorial-osr-ogrspatialreference">投影と空間参照システムチュートリアル (OSR - OGRSpatialReference)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">開発</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">コミュニティ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sponsors/index.html">スポンサー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">どのように貢献できますか?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">ライセンス</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GDAL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html"> GDAL  ドキュメント </a> &raquo;</li>
      
          <li><a href="index.html">チュートリアル</a> &raquo;</li>
      
      <li>ベクターAPIチュートリアル</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSGeo/gdal/edit/master/doc/source/tutorials/vector_api_tut.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="vector_driver_tut.html" class="btn btn-neutral float-right" title="ベクタードライバー実装チュートリアル" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="multidimensional_api_tut.html" class="btn btn-neutral float-left" title="多次元ラスタAPIチュートリアル" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vector-api-tutorial">
<span id="vector-api-tut"></span><h1>ベクターAPIチュートリアル<a class="headerlink" href="#vector-api-tutorial" title="Link to this heading"></a></h1>
<p>このドキュメントは、OGR C++クラスを使用してファイルからデータを読み書きする方法について説明することを目的としています.OGRの主要なクラスとその役割について説明した <a class="reference internal" href="../user/vector_data_model.html#vector-data-model"><span class="std std-ref">ベクターデーターモデル</span></a> ドキュメントを最初に読むことを強くお勧めします.</p>
<p>また、それに対応するCおよびPythonの関数のコードスニペットも含まれています.</p>
<section id="reading-from-ogr">
<h2>OGRからの読み込み<a class="headerlink" href="#reading-from-ogr" title="Link to this heading"></a></h2>
<p>OGRでの読み込みをデモンストレーションするために、OGRデータソースからポイントレイヤーを標準出力にカンマ区切り形式でダンプする小さなユーティリティを構築します.</p>
<p>最初に,必要なすべてのフォーマットドライバを登録する必要があります. これは通常、GDAL/OGRに組み込まれたすべてのフォーマットドライバを登録する <a class="reference internal" href="../api/raster_c_api.html#_CPPv415GDALAllRegisterv" title="GDALAllRegister"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GDALAllRegister()</span></code></a> を呼び出すことで行われます.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ogrsf_frmts.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>

<span class="p">{</span>
<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gdal.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>

<span class="p">{</span>
<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>
</pre></div>
</div>
<p>次に、入力のOGRデータソースを開く必要があります. データソースはファイル、RDBMS、ファイルでいっぱいのディレクトリ、または使用されているドライバによっては、リモートWebサービスである場合があります. ただし、データソース名は常に単一の文字列です. この場合、特定のシェープファイルを開くようにハードコードされています.2番目の引数 (GDAL_OF_VECTOR) は、<a class="reference internal" href="../api/vector_c_api.html#_CPPv47OGROpenPKciP12OGRSFDriverH" title="OGROpen"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGROpen()</span></code></a> メソッドに、ベクタードライバを使用することを指示し、更新アクセスは不要であることを示します. 失敗した場合はNULLが返され、エラーが報告されます.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">GDALDataset</span><span class="w">       </span><span class="o">*</span><span class="n">poDS</span><span class="p">;</span>

<span class="n">poDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GDALDataset</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">GDALOpenEx</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point.shp&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GDAL_OF_VECTOR</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Open failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">GDALDatasetH</span><span class="w"> </span><span class="n">hDS</span><span class="p">;</span>

<span class="n">hDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALOpenEx</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point.shp&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GDAL_OF_VECTOR</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Open failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>GDALDatasetには,関連付けられているレイヤーが多数存在する可能性があります. 利用可能なレイヤーの数は <a class="reference internal" href="../api/gdaldataset_cpp.html#_CPPv4N11GDALDataset13GetLayerCountEv" title="GDALDataset::GetLayerCount"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GDALDataset::GetLayerCount()</span></code></a> で問い合わせることができ、個々のレイヤーは <a class="reference internal" href="../api/gdaldataset_cpp.html#_CPPv4N11GDALDataset8GetLayerEi" title="GDALDataset::GetLayer"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GDALDataset::GetLayer()</span></code></a> を使用してインデックスで取得することができます. ただし、ここではレイヤーを名前で取得します.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRLayer</span><span class="w">  </span><span class="o">*</span><span class="n">poLayer</span><span class="p">;</span>

<span class="n">poLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poDS</span><span class="o">-&gt;</span><span class="n">GetLayerByName</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point&quot;</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRLayerH</span><span class="w"> </span><span class="n">hLayer</span><span class="p">;</span>

<span class="n">hLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALDatasetGetLayerByName</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point&quot;</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>次に,レイヤーから地物を読み始めたいと思います. 開始する前に,レイヤーに属性フィルタまたは空間フィルタを割り当てて,取得する地物のセットを制限することができますが,今のところはすべての地物を取得することに興味があります.</p>
<p>GDAL 2.3とC++11を使用する場合:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">poFeature</span><span class="o">:</span><span class="w"> </span><span class="n">poLayer</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
</pre></div>
</div>
<p>GDAL 2.3とCを使用する場合:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGR_FOR_EACH_FEATURE_BEGIN</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">hLayer</span><span class="p">)</span>
<span class="p">{</span>
</pre></div>
</div>
<p>古いGDALバージョンを使用する場合,レイヤーを新しく開始しているため厳密には必要ではありませんが,しばしば <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer12ResetReadingEv" title="OGRLayer::ResetReading"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::ResetReading()</span></code></a> を呼び出して,レイヤーの先頭から開始していることを確認することが賢明です. OGRLayer::GetNextFeature() を使用してレイヤー内のすべての地物を反復処理します.地物がなくなるとNULLが返されます.</p>
<p>GDAL &lt; 2.3とC++を使用する場合:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFeature</span><span class="w"> </span><span class="o">*</span><span class="n">poFeature</span><span class="p">;</span>

<span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">ResetReading</span><span class="p">();</span>
<span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">poFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">GetNextFeature</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
</pre></div>
</div>
<p>GDAL &lt; 2.3とCを使用する場合:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFeatureH</span><span class="w"> </span><span class="n">hFeature</span><span class="p">;</span>

<span class="n">OGR_L_ResetReading</span><span class="p">(</span><span class="n">hLayer</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">hFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_L_GetNextFeature</span><span class="p">(</span><span class="n">hLayer</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
</pre></div>
</div>
<p>地物のすべての属性フィールドをダンプするためには, <a class="reference internal" href="../api/ogrfeature_cpp.html#_CPPv414OGRFeatureDefn" title="OGRFeatureDefn"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">OGRFeatureDefn</span></code></a> を取得すると便利です.これは,レイヤーに関連付けられたオブジェクトで,すべてのフィールドの定義を含んでいます. すべてのフィールドを反復処理し,そのタイプに基づいて属性を取得して報告します.</p>
<p>GDAL 2.3とC++11を使用する場合:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">oField</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">poFeature</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">IsUnset</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(unset),&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">IsNull</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(null),&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetInteger</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger64</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="n">CPL_FRMT_GIB</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetInteger64</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTReal</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetDouble</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTString</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// GetString() returns a C string</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetString</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="c1">// Note: we use GetAsString() and not GetString(), since</span>
<span class="w">            </span><span class="c1">// the later assumes the field type to be OFTString while the</span>
<span class="w">            </span><span class="c1">// former will do a conversion from the original type to string.</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetAsString</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>GDAL &lt; 2.3とC++を使用する場合:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFeatureDefn</span><span class="w"> </span><span class="o">*</span><span class="n">poFDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">GetLayerDefn</span><span class="p">();</span>
<span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">poFDefn</span><span class="o">-&gt;</span><span class="n">GetFieldCount</span><span class="p">();</span><span class="w"> </span><span class="n">iField</span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">IsFieldSet</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(unset),&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">IsFieldNull</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(null),&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">OGRFieldDefn</span><span class="w"> </span><span class="o">*</span><span class="n">poFieldDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poFDefn</span><span class="o">-&gt;</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="w"> </span><span class="n">poFieldDefn</span><span class="o">-&gt;</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsInteger</span><span class="p">(</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger64</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="n">CPL_FRMT_GIB</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsInteger64</span><span class="p">(</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTReal</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsDouble</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTString</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsString</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsString</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFeatureDefnH</span><span class="w"> </span><span class="n">hFDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_L_GetLayerDefn</span><span class="p">(</span><span class="n">hLayer</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="n">iField</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">OGR_FD_GetFieldCount</span><span class="p">(</span><span class="n">hFDefn</span><span class="p">);</span><span class="w"> </span><span class="n">iField</span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">OGRFieldDefnH</span><span class="w"> </span><span class="n">hFieldDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_FD_GetFieldDefn</span><span class="p">(</span><span class="w"> </span><span class="n">hFDefn</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">OGR_F_IsFieldSet</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(unset),&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_F_IsFieldNull</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(null),&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_Fld_GetType</span><span class="p">(</span><span class="n">hFieldDefn</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsInteger</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger64</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="n">CPL_FRMT_GIB</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsInteger64</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTReal</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsDouble</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">OFTString</span><span class="p">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsString</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsString</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上記で明示的に処理されているフィールドタイプ以外にもいくつかのフィールドタイプがありますが, <a class="reference internal" href="../api/ogrfeature_cpp.html#_CPPv4NK10OGRFeature16GetFieldAsStringEi" title="OGRFeature::GetFieldAsString"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRFeature::GetFieldAsString()</span></code></a> メソッドを使用してそれらの合理的な表現を取得することができます.実際,GetFieldAsString() をすべてのタイプに使用して上記を短縮することができます.</p>
<p>次に,地物からジオメトリを抽出し,ポイントジオメトリのxとyを書き出します. ジオメトリは一般的な <a class="reference internal" href="../api/ogrgeometry_cpp.html#_CPPv411OGRGeometry" title="OGRGeometry"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">OGRGeometry</span></code></a> ポインタとして返されます. 次に,特定のジオメトリタイプを決定し,ポイントである場合はポイントにキャストして操作します. それ以外の場合はプレースホルダを書き込みます.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRGeometry</span><span class="w"> </span><span class="o">*</span><span class="n">poGeometry</span><span class="p">;</span>

<span class="n">poGeometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetGeometryRef</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poGeometry</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wkbFlatten</span><span class="p">(</span><span class="n">poGeometry</span><span class="o">-&gt;</span><span class="n">getGeometryType</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if GDAL_VERSION_NUM &gt;= GDAL_COMPUTE_VERSION(2,3,0)</span>
<span class="w">    </span><span class="n">OGRPoint</span><span class="w"> </span><span class="o">*</span><span class="n">poPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poGeometry</span><span class="o">-&gt;</span><span class="n">toPoint</span><span class="p">();</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="n">OGRPoint</span><span class="w"> </span><span class="o">*</span><span class="n">poPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">OGRPoint</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">poGeometry</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,%3.f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poPoint</span><span class="o">-&gt;</span><span class="n">getX</span><span class="p">(),</span><span class="w"> </span><span class="n">poPoint</span><span class="o">-&gt;</span><span class="n">getY</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;no point geometry</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRGeometryH</span><span class="w"> </span><span class="n">hGeometry</span><span class="p">;</span>

<span class="n">hGeometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_F_GetGeometryRef</span><span class="p">(</span><span class="n">hFeature</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hGeometry</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wkbFlatten</span><span class="p">(</span><span class="n">OGR_G_GetGeometryType</span><span class="p">(</span><span class="n">hGeometry</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,%3.f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_G_GetX</span><span class="p">(</span><span class="n">hGeometry</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">OGR_G_GetY</span><span class="p">(</span><span class="n">hGeometry</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;no point geometry</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上記で <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">wkbFlatten()</span></code> マクロを使用して, wkbPoint25D (z座標を持つポイント) のタイプを基本の2Dジオメトリタイプコード (wkbPoint) に変換します. 各2Dジオメトリタイプには対応する2.5Dタイプコードがあります.2Dおよび2.5Dジオメトリケースは同じC++クラスで処理されるため,コードは2Dまたは3Dケースを適切に処理します.</p>
<p>複数のジオメトリフィールドを地物に関連付けることができます.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRGeometry</span><span class="w"> </span><span class="o">*</span><span class="n">poGeometry</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">iGeomField</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">nGeomFieldCount</span><span class="p">;</span>

<span class="n">nGeomFieldCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetGeomFieldCount</span><span class="p">();</span>
<span class="k">for</span><span class="p">(</span><span class="n">iGeomField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iGeomField</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nGeomFieldCount</span><span class="p">;</span><span class="w"> </span><span class="n">iGeomField</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">poGeometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetGeomFieldRef</span><span class="p">(</span><span class="n">iGeomField</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poGeometry</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wkbFlatten</span><span class="p">(</span><span class="n">poGeometry</span><span class="o">-&gt;</span><span class="n">getGeometryType</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="cp">#if GDAL_VERSION_NUM &gt;= GDAL_COMPUTE_VERSION(2,3,0)</span>
<span class="w">        </span><span class="n">OGRPoint</span><span class="w"> </span><span class="o">*</span><span class="n">poPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poGeometry</span><span class="o">-&gt;</span><span class="n">toPoint</span><span class="p">();</span>
<span class="cp">#else</span>
<span class="w">        </span><span class="n">OGRPoint</span><span class="w"> </span><span class="o">*</span><span class="n">poPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">OGRPoint</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">poGeometry</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,%3.f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poPoint</span><span class="o">-&gt;</span><span class="n">getX</span><span class="p">(),</span><span class="w"> </span><span class="n">poPoint</span><span class="o">-&gt;</span><span class="n">getY</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;no point geometry</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRGeometryH</span><span class="w"> </span><span class="n">hGeometry</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">iGeomField</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">nGeomFieldCount</span><span class="p">;</span>

<span class="n">nGeomFieldCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_F_GetGeomFieldCount</span><span class="p">(</span><span class="n">hFeature</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="n">iGeomField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iGeomField</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nGeomFieldCount</span><span class="p">;</span><span class="w"> </span><span class="n">iGeomField</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">hGeometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_F_GetGeomFieldRef</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iGeomField</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hGeometry</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wkbFlatten</span><span class="p">(</span><span class="n">OGR_G_GetGeometryType</span><span class="p">(</span><span class="n">hGeometry</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,%3.f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_G_GetX</span><span class="p">(</span><span class="n">hGeometry</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">                </span><span class="n">OGR_G_GetY</span><span class="p">(</span><span class="n">hGeometry</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;no point geometry</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pythonの場合:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nGeomFieldCount</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">GetGeomFieldCount</span><span class="p">()</span>
<span class="k">for</span> <span class="n">iGeomField</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nGeomFieldCount</span><span class="p">):</span>
    <span class="n">geom</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">GetGeomFieldRef</span><span class="p">(</span><span class="n">iGeomField</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">geom</span><span class="o">.</span><span class="n">GetGeometryType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ogr</span><span class="o">.</span><span class="n">wkbPoint</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">geom</span><span class="o">.</span><span class="n">GetX</span><span class="p">(),</span> <span class="n">geom</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;no point geometry</span><span class="se">\n</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/ogrfeature_cpp.html#_CPPv4N10OGRFeature14GetGeometryRefEv" title="OGRFeature::GetGeometryRef"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRFeature::GetGeometryRef()</span></code></a> と <a class="reference internal" href="../api/ogrfeature_cpp.html#_CPPv4N10OGRFeature15GetGeomFieldRefEi" title="OGRFeature::GetGeomFieldRef"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRFeature::GetGeomFieldRef()</span></code></a> は, OGRFeatureが所有する内部ジオメトリへのポインタを返します. そこで,実際には返されたジオメトリを削除しません.</p>
<p>GDAL 2.3とC++11を使用する場合,地物の反復処理は単純に閉じカーリーブラケットで終了します.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="p">}</span>
</pre></div>
</div>
<p>GDAL 2.3とCを使用する場合,地物の反復処理は単純に以下で終了します.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">}</span>
<span class="n">OGR_FOR_EACH_FEATURE_END</span><span class="p">(</span><span class="n">hFeature</span><span class="p">)</span>
</pre></div>
</div>
<p>GDAL &lt; 2.3の場合, <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer14GetNextFeatureEv" title="OGRLayer::GetNextFeature"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::GetNextFeature()</span></code></a> メソッドは,現在所有している地物のコピーを返します.そのため,使用の最後に地物を解放する必要があります. 単に &quot;delete&quot; することもできますが,これはGDAL DLLがメインプログラムと異なる &quot;ヒープ&quot; を持つWindowsビルドで問題を引き起こす可能性があります. 安全を期すために,GDAL関数を使用して地物を削除します.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">OGRFeature</span><span class="o">::</span><span class="n">DestroyFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">OGR_F_Destroy</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/gdaldataset_cpp.html#_CPPv4N11GDALDataset14GetLayerByNameEPKc" title="GDALDataset::GetLayerByName"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GDALDataset::GetLayerByName()</span></code></a> で返されるOGRLayerも,GDALDatasetが所有する内部レイヤーへの参照です.そのため,削除する必要はありません. ただし,入力ファイルを閉じるためにデータソースを削除する必要があります.再び,特別なwin32ヒープの問題を回避するために,これをカスタム削除メソッドで行います.</p>
<p>C/C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">GDALClose</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>すべてのプログラムは次のようになります.</p>
<p>GDAL 2.3とC++11を使用する場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ogrsf_frmts.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>

<span class="p">{</span>
<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>

<span class="w">    </span><span class="n">GDALDatasetUniquePtr</span><span class="w"> </span><span class="n">poDS</span><span class="p">(</span><span class="n">GDALDataset</span><span class="o">::</span><span class="n">Open</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point.shp&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GDAL_OF_VECTOR</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Open failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">OGRLayer</span><span class="o">*</span><span class="w"> </span><span class="n">poLayer</span><span class="o">:</span><span class="w"> </span><span class="n">poDS</span><span class="o">-&gt;</span><span class="n">GetLayers</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">poFeature</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">poLayer</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">oField</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">poFeature</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">IsUnset</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(unset),&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">IsNull</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(null),&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="k">continue</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">switch</span><span class="p">(</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger</span><span class="p">:</span>
<span class="w">                        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetInteger</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<span class="w">                    </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger64</span><span class="p">:</span>
<span class="w">                        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="n">CPL_FRMT_GIB</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetInteger64</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<span class="w">                    </span><span class="k">case</span><span class="w"> </span><span class="no">OFTReal</span><span class="p">:</span>
<span class="w">                        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetDouble</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<span class="w">                    </span><span class="k">case</span><span class="w"> </span><span class="no">OFTString</span><span class="p">:</span>
<span class="w">                        </span><span class="c1">// GetString() returns a C string</span>
<span class="w">                        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetString</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<span class="w">                    </span><span class="k">default</span><span class="o">:</span>
<span class="w">                        </span><span class="c1">// Note: we use GetAsString() and not GetString(), since</span>
<span class="w">                        </span><span class="c1">// the later assumes the field type to be OFTString while the</span>
<span class="w">                        </span><span class="c1">// former will do a conversion from the original type to string.</span>
<span class="w">                        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oField</span><span class="p">.</span><span class="n">GetAsString</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">OGRGeometry</span><span class="w"> </span><span class="o">*</span><span class="n">poGeometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetGeometryRef</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poGeometry</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span>
<span class="w">                    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wkbFlatten</span><span class="p">(</span><span class="n">poGeometry</span><span class="o">-&gt;</span><span class="n">getGeometryType</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="n">OGRPoint</span><span class="w"> </span><span class="o">*</span><span class="n">poPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poGeometry</span><span class="o">-&gt;</span><span class="n">toPoint</span><span class="p">();</span>

<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,%3.f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poPoint</span><span class="o">-&gt;</span><span class="n">getX</span><span class="p">(),</span><span class="w"> </span><span class="n">poPoint</span><span class="o">-&gt;</span><span class="n">getY</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;no point geometry</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ogrsf_frmts.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>

<span class="p">{</span>
<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>

<span class="w">    </span><span class="n">GDALDataset</span><span class="w"> </span><span class="o">*</span><span class="n">poDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">GDALDataset</span><span class="o">*&gt;</span><span class="p">(</span>
<span class="w">        </span><span class="n">GDALOpenEx</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point.shp&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GDAL_OF_VECTOR</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Open failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">OGRLayer</span><span class="w">  </span><span class="o">*</span><span class="n">poLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poDS</span><span class="o">-&gt;</span><span class="n">GetLayerByName</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">OGRFeatureDefn</span><span class="w"> </span><span class="o">*</span><span class="n">poFDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">GetLayerDefn</span><span class="p">();</span>

<span class="w">    </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">ResetReading</span><span class="p">();</span>
<span class="w">    </span><span class="n">OGRFeature</span><span class="w"> </span><span class="o">*</span><span class="n">poFeature</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">poFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">GetNextFeature</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">poFDefn</span><span class="o">-&gt;</span><span class="n">GetFieldCount</span><span class="p">();</span><span class="w"> </span><span class="n">iField</span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">IsFieldSet</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(unset),&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">IsFieldNull</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(null),&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">OGRFieldDefn</span><span class="w"> </span><span class="o">*</span><span class="n">poFieldDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poFDefn</span><span class="o">-&gt;</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">);</span>

<span class="w">            </span><span class="k">switch</span><span class="p">(</span><span class="w"> </span><span class="n">poFieldDefn</span><span class="o">-&gt;</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger</span><span class="p">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsInteger</span><span class="p">(</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger64</span><span class="p">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="n">CPL_FRMT_GIB</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsInteger64</span><span class="p">(</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="no">OFTReal</span><span class="p">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsDouble</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="no">OFTString</span><span class="p">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsString</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">default</span><span class="o">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetFieldAsString</span><span class="p">(</span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">OGRGeometry</span><span class="w"> </span><span class="o">*</span><span class="n">poGeometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">GetGeometryRef</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poGeometry</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span>
<span class="w">                </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wkbFlatten</span><span class="p">(</span><span class="n">poGeometry</span><span class="o">-&gt;</span><span class="n">getGeometryType</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">OGRPoint</span><span class="w"> </span><span class="o">*</span><span class="n">poPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">OGRPoint</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">poGeometry</span><span class="p">;</span>

<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,%3.f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poPoint</span><span class="o">-&gt;</span><span class="n">getX</span><span class="p">(),</span><span class="w"> </span><span class="n">poPoint</span><span class="o">-&gt;</span><span class="n">getY</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;no point geometry</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">OGRFeature</span><span class="o">::</span><span class="n">DestroyFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GDALClose</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gdal.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>

<span class="p">{</span>
<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>

<span class="w">    </span><span class="n">GDALDatasetH</span><span class="w"> </span><span class="n">hDS</span><span class="p">;</span>
<span class="w">    </span><span class="n">OGRLayerH</span><span class="w"> </span><span class="n">hLayer</span><span class="p">;</span>
<span class="w">    </span><span class="n">OGRFeatureH</span><span class="w"> </span><span class="n">hFeature</span><span class="p">;</span>
<span class="w">    </span><span class="n">OGRFeatureDefnH</span><span class="w"> </span><span class="n">hFDefn</span><span class="p">;</span>

<span class="w">    </span><span class="n">hDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALOpenEx</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point.shp&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GDAL_OF_VECTOR</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Open failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">hLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALDatasetGetLayerByName</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">hFDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_L_GetLayerDefn</span><span class="p">(</span><span class="n">hLayer</span><span class="p">);</span>

<span class="w">    </span><span class="n">OGR_L_ResetReading</span><span class="p">(</span><span class="n">hLayer</span><span class="p">);</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">hFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_L_GetNextFeature</span><span class="p">(</span><span class="n">hLayer</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">iField</span><span class="p">;</span>
<span class="w">        </span><span class="n">OGRGeometryH</span><span class="w"> </span><span class="n">hGeometry</span><span class="p">;</span>

<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">OGR_FD_GetFieldCount</span><span class="p">(</span><span class="n">hFDefn</span><span class="p">);</span><span class="w"> </span><span class="n">iField</span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">OGRFieldDefnH</span><span class="w"> </span><span class="n">hFieldDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_FD_GetFieldDefn</span><span class="p">(</span><span class="w"> </span><span class="n">hFDefn</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">OGR_F_IsFieldSet</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(unset),&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_F_IsFieldNull</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(null),&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">switch</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_Fld_GetType</span><span class="p">(</span><span class="n">hFieldDefn</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger</span><span class="p">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%d,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsInteger</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="no">OFTInteger64</span><span class="p">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="n">CPL_FRMT_GIB</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsInteger64</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="no">OFTReal</span><span class="p">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsDouble</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="no">OFTString</span><span class="p">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsString</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">default</span><span class="o">:</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s,&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldAsString</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">iField</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">hGeometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_F_GetGeometryRef</span><span class="p">(</span><span class="n">hFeature</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hGeometry</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">wkbFlatten</span><span class="p">(</span><span class="n">OGR_G_GetGeometryType</span><span class="p">(</span><span class="n">hGeometry</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%.3f,%3.f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_G_GetX</span><span class="p">(</span><span class="n">hGeometry</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">OGR_G_GetY</span><span class="p">(</span><span class="n">hGeometry</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;no point geometry</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">OGR_F_Destroy</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GDALClose</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pythonの場合:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OpenEx</span><span class="p">(</span> <span class="s2">&quot;point.shp&quot;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OF_VECTOR</span> <span class="p">)</span>
<span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Open failed.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="n">lyr</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetLayerByName</span><span class="p">(</span> <span class="s2">&quot;point&quot;</span> <span class="p">)</span>

<span class="n">lyr</span><span class="o">.</span><span class="n">ResetReading</span><span class="p">()</span>

<span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">lyr</span><span class="p">:</span>

    <span class="n">feat_defn</span> <span class="o">=</span> <span class="n">lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">feat_defn</span><span class="o">.</span><span class="n">GetFieldCount</span><span class="p">()):</span>
        <span class="n">field_defn</span> <span class="o">=</span> <span class="n">feat_defn</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Tests below can be simplified with just :</span>
        <span class="c1"># print feat.GetField(i)</span>
        <span class="k">if</span> <span class="n">field_defn</span><span class="o">.</span><span class="n">GetType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTInteger</span> <span class="ow">or</span> <span class="n">field_defn</span><span class="o">.</span><span class="n">GetType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTInteger64</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">feat</span><span class="o">.</span><span class="n">GetFieldAsInteger64</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">field_defn</span><span class="o">.</span><span class="n">GetType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">feat</span><span class="o">.</span><span class="n">GetFieldAsDouble</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">field_defn</span><span class="o">.</span><span class="n">GetType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">feat</span><span class="o">.</span><span class="n">GetFieldAsString</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">feat</span><span class="o">.</span><span class="n">GetFieldAsString</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">geom</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">geom</span><span class="o">.</span><span class="n">GetGeometryType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ogr</span><span class="o">.</span><span class="n">wkbPoint</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">geom</span><span class="o">.</span><span class="n">GetX</span><span class="p">(),</span> <span class="n">geom</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;no point geometry</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
<section id="reading-from-ogr-using-the-arrow-c-stream-data-interface">
<span id="vector-api-tut-arrow-stream"></span><h2>Arrow C Streamデータインターフェースを使用してOGRから読み込む<a class="headerlink" href="#reading-from-ogr-using-the-arrow-c-stream-data-interface" title="Link to this heading"></a></h2>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.6.</span></p>
</div>
<p>地物を1つずつ取得する代わりに,列指向のメモリレイアウトを使用してバッチで取得することも可能であり, <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer14GetArrowStreamEP16ArrowArrayStream12CSLConstList" title="OGRLayer::GetArrowStream"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::GetArrowStream()</span></code></a> メソッドを使用します. このメソッドは,伝統的な  <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer14GetNextFeatureEv" title="OGRLayer::GetNextFeature"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::GetNextFeature()</span></code></a> アプローチよりも使用が難しく, <a class="reference external" href="https://arrow.apache.org/docs/format/CStreamInterface.html">Apache Arrow C Stream interface</a> との互換性が必要な場合や,レイヤーの列指向の利用が必要な場合にのみ推奨されます.</p>
<p>ヘルパーライブラリを使用するまで,Arrow C Streamインターフェースの利用には以下のドキュメントの読み取りが必要です:</p>
<ul class="simple">
<li><p>Arrow C Streamインターフェース &lt;<a class="reference external" href="https://arrow.apache.org/docs/format/CStreamInterface.html">https://arrow.apache.org/docs/format/CStreamInterface.html</a>&gt;`_</p></li>
<li><p>Arrow Cデータインターフェース &lt;<a class="reference external" href="https://arrow.apache.org/docs/format/CDataInterface.html">https://arrow.apache.org/docs/format/CDataInterface.html</a>&gt;`_</p></li>
<li><p>Arrow Columnar 形式 &lt;<a class="reference external" href="https://arrow.apache.org/docs/format/Columnar.html">https://arrow.apache.org/docs/format/Columnar.html</a>&gt;`_.</p></li>
</ul>
<p>Arrow C Streamインターフェースは,2つの主要なコールバックを提供する一連のC構造体,ArrowArrayStreamで構成されています:</p>
<ul class="simple">
<li><p>get_schema() コールバックでArrowSchemaを取得します. ArrowSchemaは,フィールドの説明 (名前,タイプ,メタデータ) のセットを記述します. すべてのOGRデータ型には対応するArrowデータ型があります.</p></li>
<li><p>get_next() コールバックでArrowArrayのシーケンスを取得します. ArrowArrayは,特定の列/フィールドの値のセットを特定の地物のサブセットでキャプチャします. これはPandas DataFrameの <a class="reference external" href="https://arrow.apache.org/docs/python/pandas.html#series">Series</a> の相当物です. これは,サブ配列を集約できる可能性のある階層構造であり, OGRの使用では,主な配列はOGR属性およびジオメトリフィールドのコレクションであるStructArrayになります.データ型ごとのバッファと子配列のレイアウトは, <a class="reference external" href="https://arrow.apache.org/docs/format/Columnar.html">Arrow Columnar Format</a> で詳細に説明されています.</p></li>
</ul>
<p>レイヤーが2つのフィールド (1つは整数型,1つは浮動小数点型) の4つの地物で構成されている場合,ArrowArrayとしての表現は,*概念的に* 以下のようになります:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">};</span>
<span class="n">array</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span><span class="w"> </span><span class="mf">2.3</span><span class="p">,</span><span class="w"> </span><span class="mf">3.4</span><span class="p">,</span><span class="w"> </span><span class="mf">4.5</span><span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
<p>レイヤー全体の内容は,各レコードバッチが地物のサブセットのArrowArrayであるレコードバッチのシーケンスとして見ることができます.個々の地物を反復処理する代わりに,一度に複数の地物のバッチを反復処理します.</p>
<p>ArrowArrayStream, ArrowSchema, ArrowArray構造体は,API/ABI互換性をApache Arrow C++と取得するために, ogr_recordbatch.h パブリックヘッダファイルに直接派生させて定義されています. このヘッダファイルは,関連する配列バッチAPIが使用される場合に明示的に含める必要があります.</p>
<p>GetArrowStream() メソッドのシグネチャは次のようになります:</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">OGRLayer::GetArrowStream</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">ArrowArrayStream</span><span class="o">*</span><span class="w"> </span><span class="n">out_stream</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">CSLConstList</span><span class="w"> </span><span class="n">papszOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>C APIでも <a class="reference internal" href="../api/vector_c_api.html#_CPPv420OGR_L_GetArrowStream9OGRLayerHP16ArrowArrayStreamPPc" title="OGR_L_GetArrowStream"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGR_L_GetArrowStream()</span></code></a> として利用可能です.</p>
<p>out_streamは,初期化されていない状態のArrowArrayStream構造体へのポインタであり,メソッドは初期内容を無視します.</p>
<p>成功した場合,およびストリームインターフェイスが不要になった場合, out_stream-&gt;release(out_stream) で解放する必要があります.</p>
<p>特定のドライバ実装によって指定されていない限り,ArrowArrayStream構造体およびそのコールバックが返したArrowSchemaまたはArrowArrayオブジェクトは,初期化されたOGRLayerが破棄された後 (通常はデータセットのクローズ時) には使用しないでください(解放される可能性があります). さらに,特定のドライバ実装によって指定されていない限り,特定のレイヤーで同時に1つのArrowArrayStreamのみがアクティブになります (つまり,次のものを要求する前に最後にアクティブになったものを明示的に解放する必要があります). ArrowArrayStreamを使用している間にフィルタ状態を変更したり,無視される列を変更したり,スキーマを変更したり,ResetReading()/GetNextFeature()を使用したりすることは強く推奨されず,予期しない結果につながる可能性があります. 一般的なルールとして,ArrowArrayStreamがアクティブな間にレイヤーの状態に影響を与えるOGRLayerメソッドは呼び出されるべきではありません.</p>
<p>提供される可能性のあるpapszOptionsは,キー=値の文字列のNULL終端リストであり,ドライバに固有のものである可能性があります.</p>
<p>OGRLayerには,次のようなGetArrowStream()の基本実装があります:</p>
<ul>
<li><p>get_schema() コールバックは,トップレベルオブジェクトがStruct型であり,子がFID列,すべてのOGR属性フィールドおよびジオメトリフィールドをArrowフィールドに変換したスキーマを返します. FID列は,INCLUDE_FID=NOオプションを指定することで省略することができます.</p>
<p>get_schema() が0を返し,スキーマが不要になった場合,以下の手順で解放する必要があります. これは,Arrow Cデータインターフェースで文書化されているように,他のコードによって解放されている可能性があることを考慮に入れるためです:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">out_schema</span><span class="o">-&gt;</span><span class="n">release</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">out_schema</span><span class="o">-&gt;</span><span class="n">release</span><span class="p">(</span><span class="n">out_schema</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>get_next() コールバックは,レイヤー上の次のレコードバッチを取得します.</p>
<p>out_arrayは,初期化されていない状態のArrowArray構造体へのポインタであり,メソッドは初期内容を無視します.</p>
<p>デフォルトの実装は,GetNextFeature()を内部的に使用して,最大65,536地物のバッチを取得します (MAX_FEATURES_IN_BATCH=numオプションで設定可能). デフォルトの実装によって割り当てられたバッファの開始アドレスは,64バイトの境界に整列されます.</p>
<p>デフォルトの実装は,スキーマの対応するエントリが <code class="docutils literal notranslate"><span class="pre">ARROW:extension:name</span></code> メタデータ項目に <code class="docutils literal notranslate"><span class="pre">ogc.wkb</span></code> と設定されている,バイナリフィールド内のWKBとしてジオメトリを出力します. 専門の実装は,他のフォーマットをデフォルトで出力する場合があります(特に,GeoArrow仕様に従ってエンコードされたジオメトリを返すArrowドライバ). GEOMETRY_ENCODING=WKBオプションを渡すことで,WKBの使用を強制することができます (デフォルトの実装を介して).</p>
<p>メソッドは,SetIgnoredFields() で設定された無視されるフィールドを考慮に入れることができます (デフォルトの実装は行います),SetSpatialFilter() および SetAttributeFilter() で設定されたフィルタを考慮に入れる必要があります. ただし,特定の実装は,フィルタが設定されている場合にデフォルト (遅い) 実装にフォールバックする場合があります.</p>
<p>GetNextFeature() と get_next() の呼び出しを混在させることは推奨されません. 動作は未指定です (ただし,クラッシュすることはありません).</p>
<p>get_next() が0を返し,配列が不要になった場合,以下の手順で解放する必要があります. これは,Arrow Cデータインターフェースで文書化されているように,他のコードによって解放されている可能性があることを考慮に入れるためです:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">out_array</span><span class="o">-&gt;</span><span class="n">release</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">out_array</span><span class="o">-&gt;</span><span class="n">release</span><span class="p">(</span><span class="n">out_array</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>専門の実装を持つドライバは,新しいOLCFastGetArrowStreamレイヤー機能を表明します.</p>
<p>ArrowArrayを直接使用する (プロデューサまたはコンシューマとして) ことは確かに簡単ではなく,Arrow Cデータインターフェースと列配列仕様についての深い理解が必要です. どのバッファからデータを読み取るか,どのデータ型のvoid*バッファをキャストするか,null/not_null情報を含むバッファを使用する方法,リスト型のデータ型のオフセットバッファを使用する方法などを知る必要があります.SWIG Pythonバインディング (<a class="reference external" href="https://github.com/OSGeo/gdal/blob/master/swig/include/gdal_array.i">gdal_array.i</a> ) のgdal_array._RecordBatchAsNumpy() メソッドの学習は,関連するArrowSchemaと共にArrowArrayオブジェクトを使用する方法のヒントを提供するかもしれません.</p>
<p>以下の例は,整数フィールドとジオメトリフィールドで構成されるレイヤーの内容を読み取る方法を示しています:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gdal_priv.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ogr_api.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ogrsf_frmts.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ogr_recordbatch.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cassert&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>
<span class="w">    </span><span class="n">GDALDataset</span><span class="o">*</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALDataset</span><span class="o">::</span><span class="n">Open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CPLError</span><span class="p">(</span><span class="n">CE_Failure</span><span class="p">,</span><span class="w"> </span><span class="n">CPLE_AppDefined</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Open() failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">OGRLayer</span><span class="o">*</span><span class="w"> </span><span class="n">poLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poDS</span><span class="o">-&gt;</span><span class="n">GetLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">OGRLayerH</span><span class="w"> </span><span class="n">hLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGRLayer</span><span class="o">::</span><span class="n">ToHandle</span><span class="p">(</span><span class="n">poLayer</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Get the Arrow stream</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ArrowArrayStream</span><span class="w"> </span><span class="n">stream</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">OGR_L_GetArrowStream</span><span class="p">(</span><span class="n">hLayer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CPLError</span><span class="p">(</span><span class="n">CE_Failure</span><span class="p">,</span><span class="w"> </span><span class="n">CPLE_AppDefined</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OGR_L_GetArrowStream() failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">poDS</span><span class="p">;</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Get the schema</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ArrowSchema</span><span class="w"> </span><span class="n">schema</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="n">get_schema</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">schema</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CPLError</span><span class="p">(</span><span class="n">CE_Failure</span><span class="p">,</span><span class="w"> </span><span class="n">CPLE_AppDefined</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;get_schema() failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">stream</span><span class="p">.</span><span class="n">release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">);</span>
<span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">poDS</span><span class="p">;</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check that the returned schema consists of one int64 field (for FID),</span>
<span class="w">    </span><span class="c1">// one int32 field and one binary/wkb field</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">schema</span><span class="p">.</span><span class="n">n_children</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">||</span>
<span class="w">        </span><span class="n">strcmp</span><span class="p">(</span><span class="n">schema</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;l&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="c1">// int64 -&gt; FID</span>
<span class="w">        </span><span class="n">strcmp</span><span class="p">(</span><span class="n">schema</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;i&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="c1">// int32</span>
<span class="w">        </span><span class="n">strcmp</span><span class="p">(</span><span class="n">schema</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="c1">// binary for WKB</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CPLError</span><span class="p">(</span><span class="n">CE_Failure</span><span class="p">,</span><span class="w"> </span><span class="n">CPLE_AppDefined</span><span class="p">,</span>
<span class="w">                 </span><span class="s">&quot;Layer has not the expected schema required by this example.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">schema</span><span class="p">.</span><span class="n">release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">schema</span><span class="p">);</span>
<span class="w">        </span><span class="n">stream</span><span class="p">.</span><span class="n">release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">);</span>
<span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">poDS</span><span class="p">;</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">schema</span><span class="p">.</span><span class="n">release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">schema</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Iterate over batches</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">ArrowArray</span><span class="w"> </span><span class="n">array</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="n">get_next</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">array</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span>
<span class="w">            </span><span class="n">array</span><span class="p">.</span><span class="n">release</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">assert</span><span class="p">(</span><span class="n">array</span><span class="p">.</span><span class="n">n_children</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Cast the array-&gt;children[].buffers[] to the appropriate data types</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">int_child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">assert</span><span class="p">(</span><span class="n">int_child</span><span class="o">-&gt;</span><span class="n">n_buffers</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">int_field_not_null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">int_child</span><span class="o">-&gt;</span><span class="n">buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int32_t</span><span class="o">*</span><span class="w"> </span><span class="n">int_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">int32_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">int_child</span><span class="o">-&gt;</span><span class="n">buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">wkb_child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">        </span><span class="n">assert</span><span class="p">(</span><span class="n">wkb_child</span><span class="o">-&gt;</span><span class="n">n_buffers</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">wkb_field_not_null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">wkb_child</span><span class="o">-&gt;</span><span class="n">buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int32_t</span><span class="o">*</span><span class="w"> </span><span class="n">wkb_offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">int32_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">wkb_child</span><span class="o">-&gt;</span><span class="n">buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">wkb_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">wkb_child</span><span class="o">-&gt;</span><span class="n">buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

<span class="w">        </span><span class="c1">// Lambda to check if a field is set for a given feature index</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">IsSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">buffer_not_null</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">buffer_not_null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">buffer_not_null</span><span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">8</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="c1">// Iterate through features of a batch</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">array</span><span class="p">.</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">IsSet</span><span class="p">(</span><span class="n">int_field_not_null</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;int_field[%lld] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">int_field</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;int_field[%lld] = null</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">IsSet</span><span class="p">(</span><span class="n">wkb_field_not_null</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">wkb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wkb_field</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">wkb_offset</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wkb_offset</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wkb_offset</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">                </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">wkt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">                </span><span class="n">OGRGeometry</span><span class="o">*</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">                </span><span class="n">OGRGeometryFactory</span><span class="o">::</span><span class="n">createFromWkb</span><span class="p">(</span><span class="n">wkb</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">geom</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">geom</span><span class="o">-&gt;</span><span class="n">exportToWkt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wkt</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;wkb_field[%lld] = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">wkt</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">wkt</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;invalid geometry&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">CPLFree</span><span class="p">(</span><span class="n">wkt</span><span class="p">);</span>
<span class="w">                </span><span class="k">delete</span><span class="w"> </span><span class="n">geom</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;wkb_field[%lld] = null</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Release memory taken by the batch</span>
<span class="w">        </span><span class="n">array</span><span class="p">.</span><span class="n">release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">array</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Release stream and dataset</span>
<span class="w">    </span><span class="n">stream</span><span class="p">.</span><span class="n">release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">);</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">poDS</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ArrowArrayを使用して地物をバッチで書き込む場合は, <a class="reference internal" href="#vector-api-tut-arrow-write"><span class="std std-ref">Arrow Cデータインターフェースを使用してOGRに書き込む</span></a> を参照してください.</p>
</section>
<section id="writing-to-ogr">
<h2>OGRへの書き込み<a class="headerlink" href="#writing-to-ogr" title="Link to this heading"></a></h2>
<p>OGRを介して書き込む例として,上記の逆のことを行います. 入力テキストからカンマ区切り値を読み取り, OGRを介してポイントシェープファイルに書き込む短いプログラムを作成します.</p>
<p>通常通り,すべてのドライバを登録してから,出力ファイルを作成するためにShapefileドライバを取得します.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ogrsf_frmts.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pszDriverName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ESRI Shapefile&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">GDALDriver</span><span class="w"> </span><span class="o">*</span><span class="n">poDriver</span><span class="p">;</span>

<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>

<span class="w">    </span><span class="n">poDriver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetGDALDriverManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">pszDriverName</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poDriver</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s driver not available.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pszDriverName</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ogr_api.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pszDriverName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ESRI Shapefile&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">GDALDriver</span><span class="w"> </span><span class="o">*</span><span class="n">poDriver</span><span class="p">;</span>

<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>

<span class="w">    </span><span class="n">poDriver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GDALDriver</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">GDALGetDriverByName</span><span class="p">(</span><span class="n">pszDriverName</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poDriver</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s driver not available.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pszDriverName</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>次に,データソースを作成します. ESRI Shapefileドライバを使用すると,シェープファイルのディレクトリ全体を作成するか,データソースとして単一のシェープファイルを作成することができます. この場合,名前に拡張子を含めて単一のファイルを明示的に作成します. 他のドライバは異なる動作をします. 2番目,3番目,4番目,5番目の引数はラスターの次元に関連しています(ドライバにラスター機能がある場合). 呼び出しの最後の引数はオプション値のリストですが,この場合はデフォルト値を使用します.サポートされているオプションの詳細は,フォーマットに固有です.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">GDALDataset</span><span class="w"> </span><span class="o">*</span><span class="n">poDS</span><span class="p">;</span>

<span class="n">poDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poDriver</span><span class="o">-&gt;</span><span class="n">Create</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point_out.shp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GDT_Unknown</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creation of output file failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">GDALDatasetH</span><span class="w"> </span><span class="n">hDS</span><span class="p">;</span>

<span class="n">hDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALCreate</span><span class="p">(</span><span class="w"> </span><span class="n">hDriver</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point_out.shp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GDT_Unknown</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creation of output file failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>次に,出力レイヤーを作成します. この場合,データソースが単一のファイルであるため,1つのレイヤーのみを持つことができます.wkbPointを渡して,このレイヤーでサポートされるジオメトリのタイプを指定します. この場合,座標系情報やその他の特別なレイヤー作成オプションを渡していません.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRLayer</span><span class="w"> </span><span class="o">*</span><span class="n">poLayer</span><span class="p">;</span>

<span class="n">poLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poDS</span><span class="o">-&gt;</span><span class="n">CreateLayer</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point_out&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">wkbPoint</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Layer creation failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRLayerH</span><span class="w"> </span><span class="n">hLayer</span><span class="p">;</span>

<span class="n">hLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALDatasetCreateLayer</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point_out&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">wkbPoint</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Layer creation failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>レイヤーが存在するため,レイヤーに表示される必要がある属性フィールドを作成する必要があります. 地物が書き込まれる前に,フィールドをレイヤーに追加する必要があります. フィールドを作成するには,フィールドに関する情報を持つ <a class="reference internal" href="../api/vector_c_api.html#_CPPv48OGRField" title="OGRField"><code class="xref cpp cpp-union docutils literal notranslate"><span class="pre">OGRField</span></code></a> オブジェクトを初期化します. シェープファイルの場合,フィールドの幅と精度は出力.dbfファイルの作成に重要です. そのため,特に設定しますが,一般的にはデフォルトが適しています. この例では,1つの属性のみ, x,yポイントに関連付けられた名前文字列を持つことにします.</p>
<p><a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer11CreateFieldEPK12OGRFieldDefni" title="OGRLayer::CreateField"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::CreateField()</span></code></a> に渡すテンプレートOGRFieldは内部でコピーされます. オブジェクトの所有権は保持されます.</p>
<p>C++の場合:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFieldDefn</span><span class="w"> </span><span class="n">oField</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OFTString</span><span class="w"> </span><span class="p">);</span>

<span class="n">oField</span><span class="p">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">CreateField</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">oField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creating Name field failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFieldDefnH</span><span class="w"> </span><span class="n">hFieldDefn</span><span class="p">;</span>

<span class="n">hFieldDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_Fld_Create</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OFTString</span><span class="w"> </span><span class="p">);</span>

<span class="n">OGR_Fld_SetWidth</span><span class="p">(</span><span class="w"> </span><span class="n">hFieldDefn</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_CreateField</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="p">,</span><span class="w"> </span><span class="n">hFieldDefn</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creating Name field failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="n">OGR_Fld_Destroy</span><span class="p">(</span><span class="n">hFieldDefn</span><span class="p">);</span>
</pre></div>
</div>
<p>以下のスニペットは,stdinから &quot;x,y,name&quot; 形式の行を読み取り,解析するループです.</p>
<p>C++およびCの場合:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="kt">char</span><span class="w"> </span><span class="n">szName</span><span class="p">[</span><span class="mi">33</span><span class="p">];</span>

<span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">stdin</span><span class="p">)</span>
<span class="w">       </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">fscanf</span><span class="p">(</span><span class="w"> </span><span class="n">stdin</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lf,%lf,%32s&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">szName</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
</pre></div>
</div>
<p>地物をディスクに書き込むためには,ローカルOGRFeatureを作成し,属性を設定し,ジオメトリを添付してから,レイヤーに書き込もうとします.この地物は,書き込まれるレイヤーに関連付けられたOGRFeatureDefnからインスタンス化されている必要があります.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFeature</span><span class="w"> </span><span class="o">*</span><span class="n">poFeature</span><span class="p">;</span>

<span class="n">poFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGRFeature</span><span class="o">::</span><span class="n">CreateFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">SetField</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">szName</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFeatureH</span><span class="w"> </span><span class="n">hFeature</span><span class="p">;</span>

<span class="n">hFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_F_Create</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_GetLayerDefn</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="n">OGR_F_SetFieldString</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldIndex</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">szName</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>ローカルジオメトリオブジェクトを作成し,そのコピーを地物に割り当てます (間接的に). <a class="reference internal" href="../api/ogrfeature_cpp.html#_CPPv4N10OGRFeature19SetGeometryDirectlyEP11OGRGeometry" title="OGRFeature::SetGeometryDirectly"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRFeature::SetGeometryDirectly()</span></code></a> は, <a class="reference internal" href="../api/ogrfeature_cpp.html#_CPPv4N10OGRFeature11SetGeometryEPK11OGRGeometry" title="OGRFeature::SetGeometry"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRFeature::SetGeometry()</span></code></a> と異なり,直接的なメソッドはジオメトリの所有権を地物に与えます. これは,ジオメトリの余分な深いオブジェクトコピーを回避するため,一般的に効率的です.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRPoint</span><span class="w"> </span><span class="n">pt</span><span class="p">;</span>
<span class="n">pt</span><span class="p">.</span><span class="n">setX</span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">);</span>
<span class="n">pt</span><span class="p">.</span><span class="n">setY</span><span class="p">(</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">);</span>

<span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">SetGeometry</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pt</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRGeometryH</span><span class="w"> </span><span class="n">hPt</span><span class="p">;</span>
<span class="n">hPt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_G_CreateGeometry</span><span class="p">(</span><span class="n">wkbPoint</span><span class="p">);</span>
<span class="n">OGR_G_SetPoint_2D</span><span class="p">(</span><span class="n">hPt</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>

<span class="n">OGR_F_SetGeometry</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">hPt</span><span class="w"> </span><span class="p">);</span>
<span class="n">OGR_G_DestroyGeometry</span><span class="p">(</span><span class="n">hPt</span><span class="p">);</span>
</pre></div>
</div>
<p>次に,ファイル内の地物を作成します. <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer13CreateFeatureEP10OGRFeature" title="OGRLayer::CreateFeature"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::CreateFeature()</span></code></a> は,地物の所有権を取得しないため,使用が終わったらクリーンアップします.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">CreateFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">         </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Failed to create feature in shapefile.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="n">OGRFeature</span><span class="o">::</span><span class="n">DestroyFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_CreateFeature</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="p">,</span><span class="w"> </span><span class="n">hFeature</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">         </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Failed to create feature in shapefile.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="n">OGR_F_Destroy</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>最後に,ヘッダが整然に書き出され,すべてのリソースが回収されるように,データソースを閉じる必要があります.</p>
<p>C/C++の場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">GDALClose</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>同じプログラムを1つのブロックにまとめると,次のようになります:</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ogrsf_frmts.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pszDriverName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ESRI Shapefile&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">GDALDriver</span><span class="w"> </span><span class="o">*</span><span class="n">poDriver</span><span class="p">;</span>

<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>

<span class="w">    </span><span class="n">poDriver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetGDALDriverManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">pszDriverName</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poDriver</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s driver not available.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pszDriverName</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GDALDataset</span><span class="w"> </span><span class="o">*</span><span class="n">poDS</span><span class="p">;</span>

<span class="w">    </span><span class="n">poDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poDriver</span><span class="o">-&gt;</span><span class="n">Create</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point_out.shp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GDT_Unknown</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creation of output file failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">OGRLayer</span><span class="w"> </span><span class="o">*</span><span class="n">poLayer</span><span class="p">;</span>

<span class="w">    </span><span class="n">poLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poDS</span><span class="o">-&gt;</span><span class="n">CreateLayer</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;point_out&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">wkbPoint</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Layer creation failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">OGRFieldDefn</span><span class="w"> </span><span class="n">oField</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OFTString</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="n">oField</span><span class="p">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">CreateField</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">oField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creating Name field failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">szName</span><span class="p">[</span><span class="mi">33</span><span class="p">];</span>

<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">stdin</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">fscanf</span><span class="p">(</span><span class="w"> </span><span class="n">stdin</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lf,%lf,%32s&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">szName</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">OGRFeature</span><span class="w"> </span><span class="o">*</span><span class="n">poFeature</span><span class="p">;</span>

<span class="w">        </span><span class="n">poFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGRFeature</span><span class="o">::</span><span class="n">CreateFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">SetField</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">szName</span><span class="w"> </span><span class="p">);</span>

<span class="w">        </span><span class="n">OGRPoint</span><span class="w"> </span><span class="n">pt</span><span class="p">;</span>

<span class="w">        </span><span class="n">pt</span><span class="p">.</span><span class="n">setX</span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">pt</span><span class="p">.</span><span class="n">setY</span><span class="p">(</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">);</span>

<span class="w">        </span><span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">SetGeometry</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pt</span><span class="w"> </span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">CreateFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Failed to create feature in shapefile.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">OGRFeature</span><span class="o">::</span><span class="n">DestroyFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GDALClose</span><span class="p">(</span><span class="w"> </span><span class="n">poDS</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gdal.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pszDriverName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ESRI Shapefile&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">GDALDriverH</span><span class="w"> </span><span class="n">hDriver</span><span class="p">;</span>
<span class="w">    </span><span class="n">GDALDatasetH</span><span class="w"> </span><span class="n">hDS</span><span class="p">;</span>
<span class="w">    </span><span class="n">OGRLayerH</span><span class="w"> </span><span class="n">hLayer</span><span class="p">;</span>
<span class="w">    </span><span class="n">OGRFieldDefnH</span><span class="w"> </span><span class="n">hFieldDefn</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">szName</span><span class="p">[</span><span class="mi">33</span><span class="p">];</span>

<span class="w">    </span><span class="n">GDALAllRegister</span><span class="p">();</span>

<span class="w">    </span><span class="n">hDriver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALGetDriverByName</span><span class="p">(</span><span class="w"> </span><span class="n">pszDriverName</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hDriver</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;%s driver not available.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pszDriverName</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">hDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALCreate</span><span class="p">(</span><span class="w"> </span><span class="n">hDriver</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point_out.shp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GDT_Unknown</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creation of output file failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">hLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GDALDatasetCreateLayer</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point_out&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">wkbPoint</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Layer creation failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">hFieldDefn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_Fld_Create</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">OFTString</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="n">OGR_Fld_SetWidth</span><span class="p">(</span><span class="w"> </span><span class="n">hFieldDefn</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_CreateField</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="p">,</span><span class="w"> </span><span class="n">hFieldDefn</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creating Name field failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">OGR_Fld_Destroy</span><span class="p">(</span><span class="n">hFieldDefn</span><span class="p">);</span>

<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">stdin</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">fscanf</span><span class="p">(</span><span class="w"> </span><span class="n">stdin</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lf,%lf,%32s&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">szName</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">OGRFeatureH</span><span class="w"> </span><span class="n">hFeature</span><span class="p">;</span>
<span class="w">        </span><span class="n">OGRGeometryH</span><span class="w"> </span><span class="n">hPt</span><span class="p">;</span>

<span class="w">        </span><span class="n">hFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_F_Create</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_GetLayerDefn</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">OGR_F_SetFieldString</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">OGR_F_GetFieldIndex</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">szName</span><span class="w"> </span><span class="p">);</span>

<span class="w">        </span><span class="n">hPt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_G_CreateGeometry</span><span class="p">(</span><span class="n">wkbPoint</span><span class="p">);</span>
<span class="w">        </span><span class="n">OGR_G_SetPoint_2D</span><span class="p">(</span><span class="n">hPt</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>

<span class="w">        </span><span class="n">OGR_F_SetGeometry</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="n">hPt</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">OGR_G_DestroyGeometry</span><span class="p">(</span><span class="n">hPt</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_CreateFeature</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="p">,</span><span class="w"> </span><span class="n">hFeature</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Failed to create feature in shapefile.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">OGR_F_Destroy</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">GDALClose</span><span class="p">(</span><span class="w"> </span><span class="n">hDS</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pythonの場合:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">ogr</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="n">driverName</span> <span class="o">=</span> <span class="s2">&quot;ESRI Shapefile&quot;</span>
<span class="n">drv</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span> <span class="n">driverName</span> <span class="p">)</span>
<span class="k">if</span> <span class="n">drv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> driver not available.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">driverName</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span> <span class="s2">&quot;point_out.shp&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Unknown</span> <span class="p">)</span>
<span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Creation of output file failed.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="n">lyr</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span> <span class="s2">&quot;point_out&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">wkbPoint</span> <span class="p">)</span>
<span class="k">if</span> <span class="n">lyr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Layer creation failed.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="n">field_defn</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span> <span class="p">)</span>
<span class="n">field_defn</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span> <span class="mi">32</span> <span class="p">)</span>

<span class="k">if</span> <span class="n">lyr</span><span class="o">.</span><span class="n">CreateField</span> <span class="p">(</span> <span class="n">field_defn</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Creating Name field failed.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="c1"># Expected format of user input: x y name</span>
<span class="n">linestring</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">()</span>
<span class="n">linelist</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">linestring</span><span class="p">)</span>

<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">linelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">linelist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">feat</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span> <span class="n">lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">())</span>
    <span class="n">feat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span>

    <span class="n">pt</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPoint</span><span class="p">)</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">SetPoint_2D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">feat</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lyr</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;Failed to create feature in shapefile.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

    <span class="n">feat</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

    <span class="n">linestring</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">()</span>
    <span class="n">linelist</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">linestring</span><span class="p">)</span>

<span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>複数のジオメトリフィールドを地物に関連付けることができます. この機能は,PostGISなどの一部のファイルフォーマットでのみ利用可能です.</p>
<p>このようなデータソースを作成するには,最初にジオメトリフィールドを作成する必要があります. 空間参照システムオブジェクトを,各ジオメトリフィールドに関連付けることができます.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRGeomFieldDefn</span><span class="w"> </span><span class="n">oPointField</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;PointField&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">);</span>
<span class="n">OGRSpatialReference</span><span class="o">*</span><span class="w"> </span><span class="n">poSRS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OGRSpatialReference</span><span class="p">();</span>
<span class="n">poSRS</span><span class="o">-&gt;</span><span class="n">importFromEPSG</span><span class="p">(</span><span class="mi">4326</span><span class="p">);</span>
<span class="n">oPointField</span><span class="p">.</span><span class="n">SetSpatialRef</span><span class="p">(</span><span class="n">poSRS</span><span class="p">);</span>
<span class="n">poSRS</span><span class="o">-&gt;</span><span class="n">Release</span><span class="p">();</span>

<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">CreateGeomField</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">oPointField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creating field PointField failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="n">OGRGeomFieldDefn</span><span class="w"> </span><span class="n">oFieldPoint2</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;PointField2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">);</span>
<span class="n">poSRS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OGRSpatialReference</span><span class="p">();</span>
<span class="n">poSRS</span><span class="o">-&gt;</span><span class="n">importFromEPSG</span><span class="p">(</span><span class="mi">32631</span><span class="p">);</span>
<span class="n">oPointField2</span><span class="p">.</span><span class="n">SetSpatialRef</span><span class="p">(</span><span class="n">poSRS</span><span class="p">);</span>
<span class="n">poSRS</span><span class="o">-&gt;</span><span class="n">Release</span><span class="p">();</span>

<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">CreateGeomField</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">oPointField2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creating field PointField2 failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRGeomFieldDefnH</span><span class="w"> </span><span class="n">hPointField</span><span class="p">;</span>
<span class="n">OGRGeomFieldDefnH</span><span class="w"> </span><span class="n">hPointField2</span><span class="p">;</span>
<span class="n">OGRSpatialReferenceH</span><span class="w"> </span><span class="n">hSRS</span><span class="p">;</span>

<span class="n">hPointField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_GFld_Create</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;PointField&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">);</span>
<span class="n">hSRS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OSRNewSpatialReference</span><span class="p">(</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">);</span>
<span class="n">OSRImportFromEPSG</span><span class="p">(</span><span class="n">hSRS</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">);</span>
<span class="n">OGR_GFld_SetSpatialRef</span><span class="p">(</span><span class="n">hPointField</span><span class="p">,</span><span class="w"> </span><span class="n">hSRS</span><span class="p">);</span>
<span class="n">OSRRelease</span><span class="p">(</span><span class="n">hSRS</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_CreateGeomField</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="p">,</span><span class="w"> </span><span class="n">hPointField</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creating field PointField failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="n">OGR_GFld_Destroy</span><span class="p">(</span><span class="w"> </span><span class="n">hPointField</span><span class="w"> </span><span class="p">);</span>

<span class="n">hPointField2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_GFld_Create</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;PointField2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">wkbPoint</span><span class="w"> </span><span class="p">);</span>
<span class="n">OSRImportFromEPSG</span><span class="p">(</span><span class="n">hSRS</span><span class="p">,</span><span class="w"> </span><span class="mi">32631</span><span class="p">);</span>
<span class="n">OGR_GFld_SetSpatialRef</span><span class="p">(</span><span class="n">hPointField2</span><span class="p">,</span><span class="w"> </span><span class="n">hSRS</span><span class="p">);</span>
<span class="n">OSRRelease</span><span class="p">(</span><span class="n">hSRS</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_CreateGeomField</span><span class="p">(</span><span class="w"> </span><span class="n">hLayer</span><span class="p">,</span><span class="w"> </span><span class="n">hPointField2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creating field PointField2 failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="n">OGR_GFld_Destroy</span><span class="p">(</span><span class="w"> </span><span class="n">hPointField2</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>地物をディスクに書き込むためには,ローカルOGRFeatureを作成し,属性を設定し,ジオメトリを添付してから,レイヤーに書き込もうとします.この地物は,書き込まれるレイヤーに関連付けられたOGRFeatureDefnからインスタンス化されている必要があります.</p>
<p>C++の場合 :</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFeature</span><span class="w"> </span><span class="o">*</span><span class="n">poFeature</span><span class="p">;</span>
<span class="n">OGRGeometry</span><span class="w"> </span><span class="o">*</span><span class="n">poGeometry</span><span class="p">;</span>
<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pszWKT</span><span class="p">;</span>

<span class="n">poFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGRFeature</span><span class="o">::</span><span class="n">CreateFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>

<span class="n">pszWKT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;POINT (2 49)&quot;</span><span class="p">;</span>
<span class="n">OGRGeometryFactory</span><span class="o">::</span><span class="n">createFromWkt</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pszWKT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">poGeometry</span><span class="w"> </span><span class="p">);</span>
<span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">SetGeomFieldDirectly</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;PointField&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poGeometry</span><span class="w"> </span><span class="p">);</span>

<span class="n">pszWKT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;POINT (500000 4500000)&quot;</span><span class="p">;</span>
<span class="n">OGRGeometryFactory</span><span class="o">::</span><span class="n">createFromWkt</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pszWKT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">poGeometry</span><span class="w"> </span><span class="p">);</span>
<span class="n">poFeature</span><span class="o">-&gt;</span><span class="n">SetGeomFieldDirectly</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;PointField2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">poGeometry</span><span class="w"> </span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">poLayer</span><span class="o">-&gt;</span><span class="n">CreateFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Failed to create feature.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="n">OGRFeature</span><span class="o">::</span><span class="n">DestroyFeature</span><span class="p">(</span><span class="w"> </span><span class="n">poFeature</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>Cの場合 :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFeatureH</span><span class="w"> </span><span class="n">hFeature</span><span class="p">;</span>
<span class="n">OGRGeometryH</span><span class="w"> </span><span class="n">hGeometry</span><span class="p">;</span>
<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pszWKT</span><span class="p">;</span>

<span class="n">poFeature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OGR_F_Create</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_GetLayerDefn</span><span class="p">(</span><span class="n">hLayer</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>

<span class="n">pszWKT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;POINT (2 49)&quot;</span><span class="p">;</span>
<span class="n">OGR_G_CreateFromWkt</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pszWKT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hGeometry</span><span class="w"> </span><span class="p">);</span>
<span class="n">OGR_F_SetGeomFieldDirectly</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span>
<span class="w">    </span><span class="n">OGR_F_GetGeomFieldIndex</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PointField&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">hGeometry</span><span class="w"> </span><span class="p">);</span>

<span class="n">pszWKT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;POINT (500000 4500000)&quot;</span><span class="p">;</span>
<span class="n">OGR_G_CreateFromWkt</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pszWKT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hGeometry</span><span class="w"> </span><span class="p">);</span>
<span class="n">OGR_F_SetGeomFieldDirectly</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="p">,</span>
<span class="w">    </span><span class="n">OGR_F_GetGeomFieldIndex</span><span class="p">(</span><span class="n">hFeature</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PointField2&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">hGeometry</span><span class="w"> </span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">OGR_L_CreateFeature</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OGRERR_NONE</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Failed to create feature.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="n">OGR_F_Destroy</span><span class="p">(</span><span class="w"> </span><span class="n">hFeature</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>Pythonの場合:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feat</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span> <span class="n">lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span> <span class="p">)</span>

<span class="n">feat</span><span class="o">.</span><span class="n">SetGeomFieldDirectly</span><span class="p">(</span> <span class="s2">&quot;PointField&quot;</span><span class="p">,</span>
    <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkt</span><span class="p">(</span> <span class="s2">&quot;POINT (2 49)&quot;</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">feat</span><span class="o">.</span><span class="n">SetGeomFieldDirectly</span><span class="p">(</span> <span class="s2">&quot;PointField2&quot;</span><span class="p">,</span>
    <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkt</span><span class="p">(</span> <span class="s2">&quot;POINT (500000 4500000)&quot;</span> <span class="p">)</span> <span class="p">)</span>

<span class="k">if</span> <span class="n">lyr</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span> <span class="n">feat</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Failed to create feature.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">);</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="mi">1</span> <span class="p">);</span>
</pre></div>
</div>
</section>
<section id="writing-to-ogr-using-the-arrow-c-data-interface">
<span id="vector-api-tut-arrow-write"></span><h2>Arrow Cデータインターフェースを使用してOGRに書き込む<a class="headerlink" href="#writing-to-ogr-using-the-arrow-c-data-interface" title="Link to this heading"></a></h2>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.8.</span></p>
</div>
<p>地物を1つずつ書き込む代わりに,列指向のメモリレイアウトを使用してバッチで書き込むことも可能です. これには, <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer15WriteArrowBatchEPK11ArrowSchemaP10ArrowArray12CSLConstList" title="OGRLayer::WriteArrowBatch"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::WriteArrowBatch()</span></code></a> メソッドを使用します. このメソッドは,従来の <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer13CreateFeatureEP10OGRFeature" title="OGRLayer::CreateFeature"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::CreateFeature()</span></code></a> アプローチよりも使用が難しく, <a class="reference external" href="https://arrow.apache.org/docs/format/CDataInterface.html">Apache Arrow Cデータインターフェース</a>  との互換性が必要な場合や,レイヤーの列指向書き込みが必要な場合にのみ推奨されます.</p>
<p>ヘルパーライブラリを使用するまで,Arrow Cデータインターフェースの生成には,以下のドキュメントの読み取りが必要です:</p>
<ul class="simple">
<li><p>Arrow Cデータインターフェース &lt;<a class="reference external" href="https://arrow.apache.org/docs/format/CDataInterface.html">https://arrow.apache.org/docs/format/CDataInterface.html</a>&gt;`_</p></li>
<li><p>Arrow Columnar 形式 &lt;<a class="reference external" href="https://arrow.apache.org/docs/format/Columnar.html">https://arrow.apache.org/docs/format/Columnar.html</a>&gt;`_.</p></li>
</ul>
<p>バッチ書き込みに関連するArrowSchemaおよびArrowArray基本型の紹介については, <a class="reference internal" href="#vector-api-tut-arrow-stream"><span class="std std-ref">Arrow C Streamデータインターフェースを使用してOGRから読み込む</span></a> を参照してください.</p>
<p>WriteArrowBatch() メソッドのシグネチャは次のとおりです:</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Writes a batch of rows from an ArrowArray.</span>
<span class="cm"> *</span>
<span class="cm"> * @param schema Schema of array</span>
<span class="cm"> * @param array Array of type struct. It may be released (array-&gt;release==NULL)</span>
<span class="cm"> *              after calling this method.</span>
<span class="cm"> * @param papszOptions Options. Null terminated list, or nullptr.</span>
<span class="cm"> * @return true in case of success</span>
<span class="cm"> */</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">OGRLayer::WriteArrowBatch</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">ArrowSchema</span><span class="w"> </span><span class="o">*</span><span class="n">schema</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">struct</span><span class="w"> </span><span class="nc">ArrowArray</span><span class="w"> </span><span class="o">*</span><span class="n">array</span><span class="p">,</span>
<span class="w">                                       </span><span class="n">CSLConstList</span><span class="w"> </span><span class="n">papszOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>C APIでも <a class="reference internal" href="../api/vector_c_api.html#_CPPv421OGR_L_WriteArrowBatch9OGRLayerHPK11ArrowSchemaP10ArrowArrayPPc" title="OGR_L_WriteArrowBatch"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGR_L_WriteArrowBatch()</span></code></a> として利用可能です.</p>
<p>これは,一度に複数の地物を持って <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer13CreateFeatureEP10OGRFeature" title="OGRLayer::CreateFeature"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::CreateFeature()</span></code></a> を呼び出すことに意味的に近いです.</p>
<p>ArrowArrayは,struct (format=+s) 型である必要があり,その子は一般的にOGR属性またはジオメトリフィールドにマップします(struct自体でない限り).</p>
<p>メソッド <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4NK8OGRLayer22IsArrowSchemaSupportedEPK11ArrowSchema12CSLConstListRNSt6stringE" title="OGRLayer::IsArrowSchemaSupported"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::IsArrowSchemaSupported()</span></code></a> を呼び出して,スキーマがWriteArrowBatch() でサポートされるかどうかを判断できます.</p>
<p>対応する子配列のOGRフィールドは存在し,互換性のあるタイプである必要があります. 属性フィールドの場合, <a class="reference internal" href="../api/ogrlayer_cpp.html#_CPPv4N8OGRLayer26CreateFieldFromArrowSchemaEPK11ArrowSchema12CSLConstList" title="OGRLayer::CreateFieldFromArrowSchema"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">OGRLayer::CreateFieldFromArrowSchema()</span></code></a> で作成する必要があります.</p>
<p>ジオメトリ列の配列は,バイナリまたは大きなバイナリ型である必要があり, WKBジオメトリを含んでいる必要があります.</p>
<p>この呼び出し後,渡された配列は解放された状態に設定される可能性があることに注意してください(ベース実装ではなく,ParquetやArrowなどの専門実装で行われることがあります)</p>
<p>ベース実装のサポートされているオプションは次のとおりです:</p>
<ul class="simple">
<li><p>FID=name. 配列内のFID列の名前. 指定されていない場合,GetFIDColumn() がそれを決定するために使用されます. 特別な名前OGRLayer::DEFAULT_ARROW_FID_NAME も認識されます. FID または GetFIDColumn() のどちらも設定されていない場合には,対応するArrowArrayはint32 (i) または int64 (l) 型である必要があります. 入力時に,FID列の値は地物を作成するために使用されます.出力時には,FID列の値は作成された地物のFIDで設定される可能性があります (配列が解放されていない場合).</p></li>
<li><p>GEOMETRY_NAME=name. ジオメトリ列の名前. 指定されていない場合,GetGeometryColumn() が使用されます. GEOMETRY_NAME または GetGeometryColumn() のどちらも設定されていない場合,特別な名前OGRLayer::DEFAULT_ARROW_GEOMETRY_NAME も認識されます.ジオメトリ列は,フィールドメタデータとしてARROW:extension:name=ogc.wkb を持っている場合にも識別されます. 対応するArrowArrayは,binary (w) または large binary (W) 型である必要があります.</p></li>
</ul>
<p>専門の実装を持つドライバ ( <a class="reference internal" href="../drivers/vector/parquet.html#vector-parquet"><span class="std std-ref">(Geo)Parquet</span></a> および <a class="reference internal" href="../drivers/vector/arrow.html#vector-arrow"><span class="std std-ref">(Geo)Arrow IPC File Format / Stream</span></a> など) は,OLCFastWriteArrowBatch レイヤー機能を表明します.</p>
<p>以下のPythonの例は,1つのジオメトリ列を持つレイヤーを別のフォーマットにコピーする方法を示しています:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">copy_layer</span><span class="p">(</span><span class="n">src_lyr</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">,</span> <span class="n">out_format</span><span class="p">,</span> <span class="n">lcos</span> <span class="o">=</span> <span class="p">{}):</span>
    <span class="n">stream</span> <span class="o">=</span> <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetArrowStream</span><span class="p">()</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">GetSchema</span><span class="p">()</span>

    <span class="c1"># If the source layer has a FID column and the output driver supports</span>
    <span class="c1"># a FID layer creation option, set it to the source FID column name.</span>
    <span class="k">if</span> <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetFIDColumn</span><span class="p">():</span>
        <span class="n">creationOptions</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">out_format</span><span class="p">)</span><span class="o">.</span><span class="n">GetMetadataItem</span><span class="p">(</span>
            <span class="s2">&quot;DS_LAYER_CREATIONOPTIONLIST&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">creationOptions</span> <span class="ow">and</span> <span class="s1">&#39;&quot;FID&quot;&#39;</span> <span class="ow">in</span> <span class="n">creationOptions</span><span class="p">:</span>
            <span class="n">lcos</span><span class="p">[</span><span class="s2">&quot;FID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetFIDColumn</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">out_format</span><span class="p">)</span><span class="o">.</span><span class="n">CreateDataSource</span><span class="p">(</span><span class="n">out_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_ds</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="o">.</span><span class="n">GetGeomFieldCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out_lyr</span> <span class="o">=</span> <span class="n">out_ds</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span>
                <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetName</span><span class="p">(),</span> <span class="n">geom_type</span><span class="o">=</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbNone</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">lcos</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">src_lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="o">.</span><span class="n">GetGeomFieldCount</span><span class="p">()):</span>
                <span class="n">out_lyr</span><span class="o">.</span><span class="n">CreateGeomField</span><span class="p">(</span><span class="n">src_lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="o">.</span><span class="n">GetGeomFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_lyr</span> <span class="o">=</span> <span class="n">out_ds</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span>
                <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetName</span><span class="p">(),</span>
                <span class="n">geom_type</span><span class="o">=</span><span class="n">src_lyr</span><span class="o">.</span><span class="n">GetGeomType</span><span class="p">(),</span>
                <span class="n">srs</span><span class="o">=</span><span class="n">src_lyr</span><span class="o">.</span><span class="n">GetSpatialRef</span><span class="p">(),</span>
                <span class="n">options</span><span class="o">=</span><span class="n">lcos</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">success</span><span class="p">,</span> <span class="n">error_msg</span> <span class="o">=</span> <span class="n">out_lyr</span><span class="o">.</span><span class="n">IsArrowSchemaSupported</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">success</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="n">src_geom_field_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="o">.</span><span class="n">GetGeomFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">src_lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="o">.</span><span class="n">GetGeomFieldCount</span><span class="p">())</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">GetChildrenCount</span><span class="p">()):</span>
            <span class="c1"># GetArrowStream() may return &quot;OGC_FID&quot; for a unnamed source FID</span>
            <span class="c1"># column and &quot;wkb_geometry&quot; for a unnamed source geometry column.</span>
            <span class="c1"># Also test GetFIDColumn() and src_geom_field_names if they are</span>
            <span class="c1"># named.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">schema</span><span class="o">.</span><span class="n">GetChild</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
                <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;OGC_FID&quot;</span><span class="p">,</span> <span class="s2">&quot;wkb_geometry&quot;</span><span class="p">,</span> <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetFIDColumn</span><span class="p">())</span>
                <span class="ow">and</span> <span class="n">schema</span><span class="o">.</span><span class="n">GetChild</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">src_geom_field_names</span>
            <span class="p">):</span>
                <span class="n">out_lyr</span><span class="o">.</span><span class="n">CreateFieldFromArrowSchema</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">GetChild</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="n">write_options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetFIDColumn</span><span class="p">():</span>
            <span class="n">write_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FID=&quot;</span> <span class="o">+</span> <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetFIDColumn</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span><span class="o">.</span><span class="n">GetGeomFieldCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetGeometryColumn</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">write_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;GEOMETRY_NAME=&quot;</span> <span class="o">+</span> <span class="n">src_lyr</span><span class="o">.</span><span class="n">GetGeometryColumn</span><span class="p">())</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">GetNextRecordBatch</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">out_lyr</span><span class="o">.</span><span class="n">WriteArrowBatch</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">write_options</span><span class="p">)</span>
</pre></div>
</div>
<p>Pythonバインディングの場合,上記の ogr.Layer.IsArrowSchemaSupported(), ogr.Layer.CreateFieldFromArrowSchema() およびogr.Layer.WriteArrowBatch() メソッドに加えて,3つの類似したメソッドが <a class="reference external" href="https://arrow.apache.org/docs/python/index.html">PyArrow</a> データ型を使用して存在します:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Layer</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">IsPyArrowSchemaSupported</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pa_schema</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns whether the passed pyarrow Schema is supported by the layer, as a tuple (success: bool, errorMsg: str).</span>

<span class="sd">    def CreateFieldFromPyArrowSchema(self, pa_schema, options=[]):</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="n">Create</span> <span class="n">a</span> <span class="n">field</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">passed</span> <span class="n">pyarrow</span> <span class="n">Schema</span><span class="o">.</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    def WritePyArrow(self, pa_batch, options=[]):</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="n">Write</span> <span class="n">the</span> <span class="n">content</span> <span class="n">of</span> <span class="n">the</span> <span class="n">passed</span> <span class="n">PyArrow</span> <span class="n">batch</span> <span class="p">(</span><span class="n">either</span> <span class="n">a</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">Table</span><span class="p">,</span> <span class="n">a</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">RecordBatch</span> <span class="ow">or</span> <span class="n">a</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">StructArray</span><span class="p">)</span> <span class="n">into</span> <span class="n">the</span> <span class="n">layer</span><span class="o">.</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vector_driver_tut.html" class="btn btn-neutral float-right" title="ベクタードライバー実装チュートリアル" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="multidimensional_api_tut.html" class="btn btn-neutral float-left" title="多次元ラスタAPIチュートリアル" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <div class="info">
      <a class="logo-link" href="https://osgeo.org">
        <div class="osgeo-logo"></div>
      </a>
      <div class="copyright">
      

      &copy; 1998-2024 <a href="https://github.com/warmerdam">Frank Warmerdam</a>,
      <a href="https://github.com/rouault">Even Rouault</a>, and
      <a href="https://github.com/OSGeo/gdal/graphs/contributors">others</a>


      
      </div>
    </div>
  </div>
</footer>
        </div>
      </div>
    </section>
  </div>
  
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>